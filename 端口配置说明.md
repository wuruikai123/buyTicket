# ç«¯å£é…ç½®è¯´æ˜

## ğŸ“‹ ç«¯å£é…ç½®æ€»è§ˆ

### å¼€å‘ç¯å¢ƒç«¯å£

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| **åç«¯æœåŠ¡** | 8080 | Spring Boot åº”ç”¨ |
| **Frontend-A (ç”¨æˆ·ç«¯)** | 5173 | Vite å¼€å‘æœåŠ¡å™¨ |
| **Frontend-B (ç®¡ç†ç«¯)** | 3001 | Vite å¼€å‘æœåŠ¡å™¨ |
| **Frontend-C (æ ¸é”€ç«¯)** | 5174 | Vite å¼€å‘æœåŠ¡å™¨ |

### ç”Ÿäº§ç¯å¢ƒç«¯å£

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| **Nginx** | 80, 443 | HTTP/HTTPS |
| **åç«¯æœåŠ¡** | 8080 | å†…ç½‘è®¿é—®ï¼Œé€šè¿‡ Nginx ä»£ç† |
| **MySQL** | 3306 | å†…ç½‘è®¿é—® |

---

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

### åç«¯ç«¯å£é…ç½®

**æ–‡ä»¶**ï¼š`shared-backend/src/main/resources/application.properties`

```properties
server.port=8080
```

### å‰ç«¯å¼€å‘ç«¯å£é…ç½®

#### Frontend-A (ç”¨æˆ·ç«¯)
**æ–‡ä»¶**ï¼š`frontend-a/vite.config.ts`

```typescript
server: {
  port: 5173,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // ä»£ç†åˆ°åç«¯
      changeOrigin: true
    }
  }
}
```

#### Frontend-B (ç®¡ç†ç«¯)
**æ–‡ä»¶**ï¼š`frontend-b/vite.config.ts`

```typescript
server: {
  port: 3001,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // ä»£ç†åˆ°åç«¯
      changeOrigin: true
    }
  }
}
```

#### Frontend-C (æ ¸é”€ç«¯)
**æ–‡ä»¶**ï¼š`frontend-c/vite.config.ts`

```typescript
server: {
  port: 5174,
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // ä»£ç†åˆ°åç«¯
      changeOrigin: true
    }
  }
}
```

---

## ğŸš€ å¯åŠ¨å‘½ä»¤

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# 1. å¯åŠ¨åç«¯ (ç«¯å£ 8080)
cd shared-backend
mvn spring-boot:run

# 2. å¯åŠ¨ Frontend-A (ç«¯å£ 5173)
cd frontend-a
npm run dev
# è®¿é—®: http://localhost:5173/

# 3. å¯åŠ¨ Frontend-B (ç«¯å£ 3001)
cd frontend-b
npm run dev
# è®¿é—®: http://localhost:3001/

# 4. å¯åŠ¨ Frontend-C (ç«¯å£ 5174)
cd frontend-c
npm run dev
# è®¿é—®: http://localhost:5174/
```

---

## ğŸŒ ç”Ÿäº§ç¯å¢ƒ Nginx é…ç½®

**æ–‡ä»¶**ï¼š`nginx-single-domain.conf`

```nginx
# åç«¯ API ä»£ç†
location /api/ {
    proxy_pass http://127.0.0.1:8080;  # ä»£ç†åˆ°åç«¯ 8080 ç«¯å£
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
}
```

---

## âœ… ç«¯å£æ£€æŸ¥å‘½ä»¤

### Windows

```cmd
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :8080
netstat -ano | findstr :5173
netstat -ano | findstr :3001
netstat -ano | findstr :5174

# ç»“æŸè¿›ç¨‹ (PID ä»ä¸Šé¢å‘½ä»¤è·å–)
taskkill /PID <è¿›ç¨‹ID> /F
```

### Linux/Mac

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tunlp | grep 8080
netstat -tunlp | grep 5173
netstat -tunlp | grep 3001
netstat -tunlp | grep 5174

# æˆ–ä½¿ç”¨ lsof
lsof -i :8080
lsof -i :5173
lsof -i :3001
lsof -i :5174

# ç»“æŸè¿›ç¨‹
kill -9 <è¿›ç¨‹ID>
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
2. ç»“æŸè¯¥è¿›ç¨‹
3. æˆ–è€…ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç”¨å…¶ä»–ç«¯å£

### Q2: å‰ç«¯æ— æ³•è®¿é—®åç«¯ APIï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åç«¯æ˜¯å¦åœ¨ 8080 ç«¯å£è¿è¡Œï¼Ÿ
- [ ] å‰ç«¯ vite.config.ts ä¸­çš„ proxy target æ˜¯å¦æŒ‡å‘ `http://localhost:8080`ï¼Ÿ
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ CORS é”™è¯¯ï¼Ÿ
- [ ] åç«¯æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰ï¼Ÿ

### Q3: ç”Ÿäº§ç¯å¢ƒ API è¯·æ±‚å¤±è´¥ï¼Ÿ

**æ£€æŸ¥æ¸…å•**ï¼š
- [ ] åç«¯æœåŠ¡æ˜¯å¦åœ¨ 8080 ç«¯å£è¿è¡Œï¼Ÿ
- [ ] Nginx é…ç½®ä¸­çš„ `proxy_pass` æ˜¯å¦æŒ‡å‘ `http://127.0.0.1:8080`ï¼Ÿ
- [ ] é˜²ç«å¢™æ˜¯å¦å…è®¸ Nginx è®¿é—® 8080 ç«¯å£ï¼Ÿ
- [ ] æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼š`/www/wwwlogs/buyticket_error.log`

---

## ğŸ“Š ç«¯å£æµç¨‹å›¾

### å¼€å‘ç¯å¢ƒ

```
æµè§ˆå™¨
  â†“
http://localhost:5173 (Frontend-A)
  â†“ /api/* è¯·æ±‚
Vite Proxy
  â†“
http://localhost:8080 (Backend)
  â†“
MySQL (3306)
```

### ç”Ÿäº§ç¯å¢ƒ

```
æµè§ˆå™¨
  â†“
https://åŸŸå (Nginx 80/443)
  â†“
  â”œâ”€â†’ /           â†’ Frontend-A é™æ€æ–‡ä»¶
  â”œâ”€â†’ /admin/     â†’ Frontend-B é™æ€æ–‡ä»¶
  â”œâ”€â†’ /verify/    â†’ Frontend-C é™æ€æ–‡ä»¶
  â””â”€â†’ /api/*      â†’ Proxy to Backend (8080)
                      â†“
                  Spring Boot (8080)
                      â†“
                  MySQL (3306)
```

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒ

### éœ€è¦ä¿®æ”¹ç«¯å£æ—¶

1. **åç«¯ç«¯å£**ï¼šä¿®æ”¹ `application.properties` ä¸­çš„ `server.port`
2. **å‰ç«¯å¼€å‘ç«¯å£**ï¼šä¿®æ”¹å„è‡ª `vite.config.ts` ä¸­çš„ `server.port`
3. **å‰ç«¯ä»£ç†ç«¯å£**ï¼šä¿®æ”¹å„è‡ª `vite.config.ts` ä¸­çš„ `proxy.target`
4. **ç”Ÿäº§ç¯å¢ƒ**ï¼šä¿®æ”¹ Nginx é…ç½®ä¸­çš„ `proxy_pass`

### é‡å¯æœåŠ¡

- **åç«¯**ï¼šé‡å¯ Spring Boot åº”ç”¨
- **å‰ç«¯å¼€å‘**ï¼šCtrl+C åœæ­¢ï¼Œç„¶åé‡æ–° `npm run dev`
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé‡å¯ Nginx å’Œåç«¯æœåŠ¡

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒ**ï¼šå‰ç«¯é€šè¿‡ Vite proxy è®¿é—®åç«¯ï¼Œé¿å… CORS é—®é¢˜
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šå‰ç«¯é€šè¿‡ Nginx åå‘ä»£ç†è®¿é—®åç«¯ï¼Œæ— éœ€ CORS é…ç½®
3. **ç«¯å£å†²çª**ï¼šç¡®ä¿å„æœåŠ¡ä½¿ç”¨ä¸åŒçš„ç«¯å£
4. **é˜²ç«å¢™**ï¼šç”Ÿäº§ç¯å¢ƒåªéœ€å¼€æ”¾ 80 å’Œ 443 ç«¯å£ï¼Œå…¶ä»–ç«¯å£ä»…å†…ç½‘è®¿é—®
5. **å®‰å…¨æ€§**ï¼šä¸è¦å°†æ•°æ®åº“ç«¯å£æš´éœ²åˆ°å…¬ç½‘

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

- [ ] åç«¯ç«¯å£é…ç½®ä¸º 8080
- [ ] Frontend-A å¼€å‘ç«¯å£é…ç½®ä¸º 5173
- [ ] Frontend-B å¼€å‘ç«¯å£é…ç½®ä¸º 3001
- [ ] Frontend-C å¼€å‘ç«¯å£é…ç½®ä¸º 5174
- [ ] æ‰€æœ‰å‰ç«¯ proxy target éƒ½æŒ‡å‘ `http://localhost:8080`
- [ ] Nginx é…ç½®ä¸­ proxy_pass æŒ‡å‘ `http://127.0.0.1:8080`
- [ ] æ‰€æœ‰ç«¯å£éƒ½æ²¡æœ‰å†²çª
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®

---

é…ç½®å®Œæˆï¼ğŸ‰
