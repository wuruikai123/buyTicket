# 图片上传功能配置说明

## 完成的工作

### 1. 后端文件上传接口
✅ 创建 `AdminFileController.java`
- `POST /api/v1/admin/file/upload` - 上传图片
- `DELETE /api/v1/admin/file/delete` - 删除图片
- 支持图片类型验证
- 文件大小限制（5MB）
- 自动生成唯一文件名

### 2. 静态资源配置
✅ 创建 `WebMvcConfig.java`
- 配置 `/uploads/**` 路径映射
- 支持通过HTTP访问上传的图片

### 3. B端图片上传组件
✅ 更新 `AboutManagement.vue`
- 使用 `el-upload` 组件
- 支持点击上传
- 支持拖拽上传
- 实时预览上传的图片
- 删除图片功能
- 上传进度提示

## 配置步骤

### 1. 配置上传目录

在 `application.yml` 中添加配置：

```yaml
# 文件上传配置
file:
  upload:
    path: D:/uploads  # Windows系统
    # path: /var/uploads  # Linux系统
```

或者使用相对路径（相对于项目运行目录）：
```yaml
file:
  upload:
    path: uploads
```

### 2. 创建上传目录

手动创建上传目录，或者程序会自动创建：
```bash
# Windows
mkdir D:\uploads

# Linux
mkdir -p /var/uploads
chmod 755 /var/uploads
```

### 3. 配置文件大小限制

在 `application.yml` 中配置：
```yaml
spring:
  servlet:
    multipart:
      max-file-size: 5MB
      max-request-size: 10MB
```

## 使用说明

### B端上传图片

1. 进入"系统设置" → "关于展厅"
2. 在图片上传区域：
   - **点击上传**：点击上传框，选择图片文件
   - **拖拽上传**：直接将图片拖拽到上传框
3. 上传成功后自动显示预览
4. 点击"删除图片"按钮可以清除图片
5. 点击"保存配置"保存所有更改

### 图片要求

- **格式**：JPG、PNG、GIF等图片格式
- **大小**：不超过5MB
- **背景图**：建议16:9比例
- **介绍图**：比例不限

## 文件存储

### 存储位置
- 上传的文件保存在配置的 `file.upload.path` 目录
- 文件名使用UUID生成，避免重复

### 访问路径
- 上传后返回的URL格式：`/uploads/文件名.jpg`
- 完整访问路径：`http://域名/uploads/文件名.jpg`

### 示例
```
上传文件：image.jpg
保存为：/uploads/a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpg
访问URL：/uploads/a1b2c3d4-e5f6-7890-abcd-ef1234567890.jpg
```

## 安全建议

1. **文件类型验证**：只允许上传图片文件
2. **文件大小限制**：限制单个文件不超过5MB
3. **文件名随机化**：使用UUID避免文件名冲突和安全问题
4. **目录权限**：确保上传目录有适当的读写权限

## 生产环境部署

### 使用Nginx代理

```nginx
location /uploads/ {
    alias /var/uploads/;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

### 使用OSS对象存储

如需使用阿里云OSS、腾讯云COS等对象存储服务，需要：
1. 修改 `AdminFileController.java`
2. 集成对应的SDK
3. 配置访问密钥和Bucket信息

## 相关文件

### 后端
- `shared-backend/src/main/java/com/buyticket/controller/admin/AdminFileController.java` - 文件上传接口
- `shared-backend/src/main/java/com/buyticket/config/WebMvcConfig.java` - 静态资源配置

### 前端
- `frontend-b/src/views/system/AboutManagement.vue` - 图片上传页面

### 配置
- `application.yml` - 上传路径配置

## 故障排查

### 问题1：上传失败
- 检查上传目录是否存在
- 检查目录权限是否正确
- 检查文件大小是否超限

### 问题2：图片无法访问
- 检查静态资源配置是否正确
- 检查文件路径是否正确
- 检查Nginx配置（如果使用）

### 问题3：上传后图片不显示
- 检查返回的URL格式
- 检查浏览器控制台错误信息
- 检查跨域配置
