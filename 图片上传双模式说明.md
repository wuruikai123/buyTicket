# 图片上传双模式说明

## 功能概述
B端"关于展厅"配置页面支持两种图片设置方式：
1. **上传图片**：点击或拖拽上传本地图片文件
2. **输入URL**：直接输入图片的网络地址

用户可以通过单选按钮在两种模式之间切换。

## 使用方法

### 方式一：上传图片
1. 选择"上传图片"单选按钮
2. 点击上传区域或拖拽图片文件到上传区域
3. 系统会自动上传并保存图片
4. 上传成功后显示图片预览
5. 可点击"删除图片"按钮移除

**限制：**
- 只能上传图片格式文件（jpg, png, gif等）
- 文件大小不超过5MB

### 方式二：输入URL
1. 选择"输入URL"单选按钮
2. 在输入框中粘贴图片的完整URL地址
3. 点击"预览"按钮可在新窗口查看图片
4. 点击输入框右侧的清除按钮可清空URL

**示例URL：**
```
https://example.com/images/banner.jpg
http://localhost:8089/uploads/abc123.png
```

## 上传接口

### 后端接口
- **路径**: `POST /api/v1/admin/file/upload`
- **参数**: `file` (MultipartFile)
- **返回**: 
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "url": "/uploads/uuid-filename.jpg",
    "filename": "uuid-filename.jpg"
  }
}
```

### 前端配置
上传地址会根据环境变量自动配置：
- 开发环境: `http://localhost:8089/api/v1/admin/file/upload`
- 生产环境: `https://your-domain.com/api/v1/admin/file/upload`

## 故障排查

### 上传失败（404错误）
**可能原因：**
1. 后端服务未启动
2. 后端端口配置错误
3. 上传路径配置问题

**解决方案：**
1. 检查后端服务是否运行在正确端口（默认8089）
2. 检查 `application.yml` 中的 `file.upload.path` 配置
3. 使用"输入URL"模式作为临时替代方案

### 上传成功但图片无法显示
**可能原因：**
1. 静态资源路径配置错误
2. 上传目录权限问题

**解决方案：**
1. 检查 `WebMvcConfig` 中的资源映射配置
2. 确保上传目录有读写权限
3. 检查返回的URL路径是否正确

### 跨域问题
如果前后端分离部署，可能遇到跨域问题。

**解决方案：**
后端需要配置CORS，允许前端域名访问。

## 文件存储

### 存储位置
- 默认路径: `uploads/` （相对于后端项目根目录）
- 可通过 `application.yml` 配置：
```yaml
file:
  upload:
    path: /var/www/uploads  # 绝对路径
```

### 文件命名
上传的文件会自动重命名为UUID格式，避免文件名冲突：
```
原文件名: photo.jpg
保存文件名: 550e8400-e29b-41d4-a716-446655440000.jpg
```

### 访问路径
上传后的文件通过以下路径访问：
```
/uploads/550e8400-e29b-41d4-a716-446655440000.jpg
```

完整URL示例：
```
http://localhost:8089/uploads/550e8400-e29b-41d4-a716-446655440000.jpg
```

## 修改的文件
- `frontend-b/src/views/system/AboutManagement.vue` - 添加双模式支持
- `shared-backend/src/main/java/com/buyticket/controller/admin/AdminFileController.java` - 上传接口
- `shared-backend/src/main/java/com/buyticket/config/WebMvcConfig.java` - 静态资源配置

## 注意事项
1. 上传模式和URL模式互不影响，可随时切换
2. 切换模式不会清空已设置的图片URL
3. 保存配置时，无论使用哪种模式，最终都是保存图片URL到数据库
4. 建议生产环境使用CDN或对象存储服务（如阿里云OSS）
