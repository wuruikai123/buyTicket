# ç”Ÿäº§ç¯å¢ƒé…ç½®è¯´æ˜

## ğŸ“‹ é…ç½®æ€»è§ˆ

### å¼€å‘ç¯å¢ƒ vs ç”Ÿäº§ç¯å¢ƒ

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|
| **å‰ç«¯è¿è¡Œæ–¹å¼** | Vite å¼€å‘æœåŠ¡å™¨ | é™æ€æ–‡ä»¶ï¼ˆNginxï¼‰ |
| **API è¯·æ±‚** | Vite Proxy ä»£ç† | Nginx åå‘ä»£ç† |
| **åç«¯åœ°å€** | `http://localhost:8080` | `http://127.0.0.1:8080` (å†…ç½‘) |
| **å‰ç«¯è®¿é—®** | å„è‡ªç«¯å£ (5173/3001/5174) | ç»Ÿä¸€åŸŸåä¸åŒè·¯å¾„ |

---

## âœ… å·²å®Œæˆçš„é…ç½®

### 1. å‰ç«¯é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

æ‰€æœ‰ä¸‰ä¸ªå‰ç«¯çš„ `vite.config.ts` å·²é…ç½®ä¸ºï¼š

**Frontend-A (ç”¨æˆ·ç«¯)**
```typescript
{
  base: '/',
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8080'  // å¼€å‘ç¯å¢ƒ
      }
    }
  }
}
```

**Frontend-B (ç®¡ç†ç«¯)**
```typescript
{
  base: '/admin/',
  server: {
    port: 3001,
    proxy: {
      '/api': {
        target: 'http://localhost:8080'  // å¼€å‘ç¯å¢ƒ
      }
    }
  }
}
```

**Frontend-C (æ ¸é”€ç«¯)**
```typescript
{
  base: '/verify/',
  server: {
    port: 5174,
    proxy: {
      '/api': {
        target: 'http://localhost:8080'  // å¼€å‘ç¯å¢ƒ
      }
    }
  }
}
```

### 2. API è¯·æ±‚é…ç½®

æ‰€æœ‰å‰ç«¯çš„ `request.ts` å·²é…ç½®ä¸ºä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼š

- Frontend-A: `baseURL: '/api/v1'`
- Frontend-B: `baseURL: '/api/v1'`
- Frontend-C: `baseURL: '/api/v1/admin'`

è¿™æ ·åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨å‘é€åˆ°åŒåŸŸåä¸‹çš„ `/api/` è·¯å¾„ï¼Œç”± Nginx ä»£ç†åˆ°åç«¯ã€‚

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ„å»ºå‰ç«¯

åœ¨æœ¬åœ°æ‰§è¡Œï¼š

```bash
# æ„å»º Frontend-A
cd frontend-a
npm run build

# æ„å»º Frontend-B
cd ../frontend-b
npm run build

# æ„å»º Frontend-C
cd ../frontend-c
npm run build
```

æ„å»ºå®Œæˆåï¼Œæ¯ä¸ªé¡¹ç›®çš„ `dist` ç›®å½•åŒ…å«ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶ã€‚

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ°æœåŠ¡å™¨

å°†æ„å»ºå¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼š

```
/www/wwwroot/buyticket/
â”œâ”€â”€ frontend-a/     â† ä¸Šä¼  frontend-a/dist/* çš„å†…å®¹
â”œâ”€â”€ frontend-b/     â† ä¸Šä¼  frontend-b/dist/* çš„å†…å®¹
â””â”€â”€ frontend-c/     â† ä¸Šä¼  frontend-c/dist/* çš„å†…å®¹
```

**é‡è¦**ï¼šä¸Šä¼ çš„æ˜¯ `dist` ç›®å½•**é‡Œé¢çš„å†…å®¹**ï¼Œä¸æ˜¯ `dist` ç›®å½•æœ¬èº«ï¼

### ç¬¬ä¸‰æ­¥ï¼šé…ç½® Nginx

ä½¿ç”¨ `nginx-single-domain.conf` æ¨¡æ¿é…ç½® Nginxï¼š

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name www.yourdomain.com;  # æ”¹ä¸ºä½ çš„åŸŸå
    
    # ç”¨æˆ·ç«¯
    location / {
        root /www/wwwroot/buyticket/frontend-a;
        try_files $uri $uri/ /index.html;
    }
    
    # ç®¡ç†ç«¯
    location /admin {
        alias /www/wwwroot/buyticket/frontend-b;
        try_files $uri $uri/ /admin/index.html;
    }
    
    # æ ¸é”€ç«¯
    location /verify {
        alias /www/wwwroot/buyticket/frontend-c;
        try_files $uri $uri/ /verify/index.html;
    }
    
    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

### ç¬¬å››æ­¥ï¼šé…ç½®åç«¯

ä¿®æ”¹åç«¯é…ç½®æ–‡ä»¶ `application.yml`ï¼š

```yaml
spring:
  profiles:
    active: prod  # ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®

---
# ç”Ÿäº§ç¯å¢ƒé…ç½®
spring:
  config:
    activate:
      on-profile: prod
  
  datasource:
    url: jdbc:mysql://localhost:3306/buyticket?...
    username: buyticket
    password: ä½ çš„æ•°æ®åº“å¯†ç 

alipay:
  notify-url: https://www.yourdomain.com/api/v1/payment/alipay/notify
  return-url: https://www.yourdomain.com/order-success
  gateway-url: https://openapi.alipay.com/gateway.do  # ç”Ÿäº§ç½‘å…³
```

### ç¬¬äº”æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨åç«¯ï¼š

```bash
cd /www/wwwroot/buyticket/shared-backend
java -jar buyticket-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```

æˆ–ä½¿ç”¨å®å¡”é¢æ¿çš„ Java é¡¹ç›®ç®¡ç†å™¨å¯åŠ¨ã€‚

---

## ğŸ” é…ç½®éªŒè¯

### å¼€å‘ç¯å¢ƒéªŒè¯

```bash
# å¯åŠ¨åç«¯
cd shared-backend
mvn spring-boot:run

# å¯åŠ¨å‰ç«¯ï¼ˆåˆ†åˆ«åœ¨ä¸‰ä¸ªç»ˆç«¯ï¼‰
cd frontend-a && npm run dev  # http://localhost:5173
cd frontend-b && npm run dev  # http://localhost:3001
cd frontend-c && npm run dev  # http://localhost:5174
```

### ç”Ÿäº§ç¯å¢ƒéªŒè¯

è®¿é—®ä»¥ä¸‹åœ°å€ï¼š

- ç”¨æˆ·ç«¯ï¼š`https://www.yourdomain.com/`
- ç®¡ç†ç«¯ï¼š`https://www.yourdomain.com/admin/`
- æ ¸é”€ç«¯ï¼š`https://www.yourdomain.com/verify/`
- APIæµ‹è¯•ï¼š`https://www.yourdomain.com/api/v1/exhibition/list`

---

## ğŸ“Š é…ç½®å¯¹æ¯”è¡¨

| é¡¹ç›® | Baseè·¯å¾„ | å¼€å‘ç«¯å£ | å¼€å‘ä»£ç† | ç”Ÿäº§è®¿é—®è·¯å¾„ |
|------|----------|----------|----------|--------------|
| Frontend-A | `/` | 5173 | `localhost:8080` | `https://åŸŸå/` |
| Frontend-B | `/admin/` | 3001 | `localhost:8080` | `https://åŸŸå/admin/` |
| Frontend-C | `/verify/` | 5174 | `localhost:8080` | `https://åŸŸå/verify/` |
| Backend | - | 8080 | - | `https://åŸŸå/api/` (Nginxä»£ç†) |

---

## ğŸ¯ å…³é”®é…ç½®è¯´æ˜

### 1. Base è·¯å¾„

- **å¼€å‘ç¯å¢ƒ**ï¼šVite è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€å…³å¿ƒ
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ„å»ºæ—¶ä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ‰€æœ‰èµ„æºè·¯å¾„å‰

### 2. API è¯·æ±‚

- **å¼€å‘ç¯å¢ƒ**ï¼šé€šè¿‡ Vite Proxy ä»£ç†åˆ° `localhost:8080`
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šé€šè¿‡ Nginx åå‘ä»£ç†åˆ° `127.0.0.1:8080`

### 3. é™æ€èµ„æº

- **å¼€å‘ç¯å¢ƒ**ï¼šVite å®æ—¶ç¼–è¯‘
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šæ„å»ºåçš„é™æ€æ–‡ä»¶ï¼Œç”± Nginx ç›´æ¥æä¾›

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒ

1. **åç«¯å¿…é¡»å…ˆå¯åŠ¨**ï¼šå‰ç«¯ä¾èµ–åç«¯ API
2. **ç«¯å£ä¸èƒ½å†²çª**ï¼šç¡®ä¿ 8080, 5173, 3001, 5174 ç«¯å£å¯ç”¨
3. **æ•°æ®åº“å¿…é¡»è¿è¡Œ**ï¼šåç«¯éœ€è¦è¿æ¥æ•°æ®åº“

### ç”Ÿäº§ç¯å¢ƒ

1. **åŸŸåå¿…é¡»è§£æ**ï¼šDNS è§£æåˆ°æœåŠ¡å™¨ IP
2. **SSL è¯ä¹¦é…ç½®**ï¼šå»ºè®®ä½¿ç”¨ HTTPS
3. **é˜²ç«å¢™é…ç½®**ï¼šå¼€æ”¾ 80, 443 ç«¯å£
4. **åç«¯å†…ç½‘è¿è¡Œ**ï¼š8080 ç«¯å£ä¸å¯¹å¤–å¼€æ”¾
5. **æ–‡ä»¶æƒé™**ï¼šç¡®ä¿ Nginx æœ‰è¯»å–æƒé™

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå¼€å‘ç¯å¢ƒ API è¯·æ±‚å¤±è´¥

**æ£€æŸ¥**ï¼š
- åç«¯æ˜¯å¦åœ¨ 8080 ç«¯å£è¿è¡Œï¼Ÿ
- æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
- Vite proxy é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ

### é—®é¢˜2ï¼šç”Ÿäº§ç¯å¢ƒé¡µé¢ 404

**æ£€æŸ¥**ï¼š
- Nginx é…ç½®ä¸­çš„ `try_files` æ˜¯å¦æ­£ç¡®ï¼Ÿ
- æ–‡ä»¶æ˜¯å¦ä¸Šä¼ åˆ°æ­£ç¡®çš„ç›®å½•ï¼Ÿ
- Base è·¯å¾„æ˜¯å¦ä¸ Nginx location åŒ¹é…ï¼Ÿ

### é—®é¢˜3ï¼šç”Ÿäº§ç¯å¢ƒ API è¯·æ±‚å¤±è´¥

**æ£€æŸ¥**ï¼š
- åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼Ÿ
- Nginx ä»£ç†é…ç½®æ˜¯å¦æ­£ç¡®ï¼Ÿ
- é˜²ç«å¢™æ˜¯å¦å…è®¸ Nginx è®¿é—®åç«¯ï¼Ÿ

---

## ğŸ“ å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### å¼€å‘ç¯å¢ƒ

```bash
# å¯åŠ¨åç«¯
cd shared-backend && mvn spring-boot:run

# å¯åŠ¨å‰ç«¯
cd frontend-a && npm run dev
cd frontend-b && npm run dev
cd frontend-c && npm run dev
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
# æ„å»ºå‰ç«¯
cd frontend-a && npm run build
cd frontend-b && npm run build
cd frontend-c && npm run build

# æ‰“åŒ…åç«¯
cd shared-backend && mvn clean package -DskipTests

# å¯åŠ¨åç«¯ï¼ˆæœåŠ¡å™¨ä¸Šï¼‰
java -jar buyticket-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod
```

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒ
- [ ] åç«¯ç«¯å£é…ç½®ä¸º 8080
- [ ] ä¸‰ä¸ªå‰ç«¯ proxy éƒ½æŒ‡å‘ `localhost:8080`
- [ ] æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®
- [ ] æ‰€æœ‰æœåŠ¡å¯ä»¥æ­£å¸¸å¯åŠ¨

### ç”Ÿäº§ç¯å¢ƒ
- [ ] ä¸‰ä¸ªå‰ç«¯ base è·¯å¾„é…ç½®æ­£ç¡®
- [ ] Nginx é…ç½®æ–‡ä»¶æ­£ç¡®
- [ ] åç«¯é…ç½®ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒ
- [ ] åŸŸåå·²è§£æ
- [ ] SSL è¯ä¹¦å·²é…ç½®
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

é…ç½®å®Œæˆï¼ğŸ‰

ç°åœ¨ä½ å¯ä»¥ï¼š
- âœ… åœ¨å¼€å‘ç¯å¢ƒæ­£å¸¸å¼€å‘å’Œè°ƒè¯•
- âœ… æ„å»ºåç›´æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- âœ… æ— éœ€ä¿®æ”¹ä»£ç ï¼Œè‡ªåŠ¨é€‚é…ç¯å¢ƒ
