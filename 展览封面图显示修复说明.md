# 展览封面图显示修复说明

## 问题描述

展览列表和首页的展览卡片中，封面图显示为灰色占位符，没有加载实际图片。

## 问题原因

数据库中存储的图片路径是相对路径（如 `/uploads/xxx.jpg`），前端直接使用这个路径无法访问到后端的图片资源。

需要将相对路径转换为完整的URL：`http://localhost:8080/uploads/xxx.jpg`

## 修复内容

### 1. 展览列表页面（Exhibitions.vue）

**修改位置**：`frontend-a/src/views/Exhibitions.vue`

**修改内容**：
```typescript
exhibitions.value = filtered.map(item => ({
    ...item,
    dateRange: item.startDate && item.endDate ? `${item.startDate} - ${item.endDate}` : '待定',
    // 处理封面图路径：如果是相对路径，加上后端URL前缀
    coverImage: item.coverImage && !item.coverImage.startsWith('http') 
        ? `http://localhost:8080${item.coverImage}` 
        : item.coverImage
}));
```

**效果**：
- 展览列表中的封面图正常显示
- 支持相对路径和绝对路径

### 2. 首页（Home.vue）

**修改位置**：`frontend-a/src/views/Home.vue`

**修改内容**：

#### 2.1 轮播图图片
```typescript
const rawBanners = (data?.data ?? data ?? []) as Banner[];
// 处理轮播图图片路径
banners.value = rawBanners.map(banner => ({
    ...banner,
    coverImage: banner.coverImage && !banner.coverImage.startsWith('http')
        ? `http://localhost:8080${banner.coverImage}`
        : banner.coverImage
}));
```

#### 2.2 近期展览图片
```typescript
const formattedList = list.slice(0, 2).map(item => ({
    ...item,
    date: item.startDate ? item.startDate : '待定',
    // 处理封面图路径
    coverImage: item.coverImage && !item.coverImage.startsWith('http')
        ? `http://localhost:8080${item.coverImage}`
        : item.coverImage
}));
```

**效果**：
- 首页轮播图正常显示
- 首页近期展览卡片的封面图正常显示

### 3. 展览详情页面（TicketPurchase.vue）

**修改位置**：`frontend-a/src/views/TicketPurchase.vue`

**修改内容**：

#### 3.1 封面图
```typescript
exhibition.value = {
    ...data,
    shortDescription: data.shortDesc || '',
    dateRange: data.startDate && data.endDate ? `${data.startDate} — ${data.endDate}` : '待定',
    images: imagesArray,
    // 处理封面图路径
    coverImage: data.coverImage && !data.coverImage.startsWith('http')
        ? `http://localhost:8080${data.coverImage}`
        : data.coverImage
};
```

#### 3.2 详情图片
```typescript
const parsed = JSON.parse(data.detailImages);
// 处理详情图片路径
imagesArray = parsed.map((img: string) => 
    img && !img.startsWith('http') 
        ? `http://localhost:8080${img}` 
        : img
);
```

**效果**：
- 展览详情页的封面图正常显示
- 展览详情页的介绍插图正常显示

## 路径处理逻辑

### 判断条件
```typescript
item.coverImage && !item.coverImage.startsWith('http')
```

### 处理方式
- **相对路径**（如 `/uploads/xxx.jpg`）→ 加上前缀 → `http://localhost:8080/uploads/xxx.jpg`
- **绝对路径**（如 `http://example.com/xxx.jpg`）→ 保持不变
- **空值**（null/undefined）→ 保持不变

## 测试验证

### 1. 展览列表页面
1. 访问：http://localhost:5173/exhibitions
2. 切换"进行中"和"待开始"标签
3. 检查每个展览卡片的封面图是否正常显示

### 2. 首页
1. 访问：http://localhost:5173/
2. 检查轮播图是否正常显示
3. 检查"近期展览"区域的展览卡片封面图是否正常显示

### 3. 展览详情页
1. 点击任意展览进入详情页
2. 检查顶部封面图是否正常显示
3. 检查"展览详情"区域的介绍插图是否正常显示

## 数据库图片路径格式

### 当前格式（相对路径）
```
/uploads/2024/01/xxx.jpg
```

### 转换后（完整URL）
```
http://localhost:8080/uploads/2024/01/xxx.jpg
```

## 注意事项

### 1. 开发环境 vs 生产环境

**当前代码**：硬编码了 `http://localhost:8080`

**生产环境需要修改为**：
```typescript
const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080';

coverImage: item.coverImage && !item.coverImage.startsWith('http')
    ? `${API_BASE_URL}${item.coverImage}`
    : item.coverImage
```

然后在 `.env.production` 中配置：
```
VITE_API_BASE_URL=https://your-production-domain.com
```

### 2. 图片不显示的其他可能原因

#### 原因1：图片文件不存在
**检查**：
```bash
# 检查后端uploads目录
ls -la shared-backend/uploads/
```

#### 原因2：后端静态资源配置问题
**检查**：后端是否配置了静态资源访问

#### 原因3：跨域问题
**检查**：浏览器控制台是否有CORS错误

#### 原因4：图片路径错误
**检查**：数据库中的路径是否正确
```sql
SELECT id, name, cover_image FROM exhibition;
```

## 优化建议

### 1. 创建统一的图片URL处理函数

**位置**：`frontend-a/src/utils/image.ts`

```typescript
/**
 * 处理图片URL
 * @param path 图片路径（可能是相对路径或绝对路径）
 * @returns 完整的图片URL
 */
export function getImageUrl(path: string | null | undefined): string {
    if (!path) return '';
    if (path.startsWith('http')) return path;
    
    const API_BASE_URL = import.meta.env.VITE_API_BASE_URL || 'http://localhost:8080';
    return `${API_BASE_URL}${path}`;
}

/**
 * 处理图片数组
 */
export function getImageUrls(paths: string[]): string[] {
    return paths.map(getImageUrl);
}
```

### 2. 使用统一函数

```typescript
import { getImageUrl, getImageUrls } from '@/utils/image';

// 单个图片
coverImage: getImageUrl(item.coverImage)

// 图片数组
images: getImageUrls(parsed)
```

### 3. 优点
- 代码复用，减少重复
- 统一管理，易于维护
- 环境切换方便

## 完成检查清单

- [x] 修改展览列表页面（Exhibitions.vue）
- [x] 修改首页轮播图（Home.vue）
- [x] 修改首页近期展览（Home.vue）
- [x] 修改展览详情封面图（TicketPurchase.vue）
- [x] 修改展览详情介绍插图（TicketPurchase.vue）
- [ ] 测试展览列表页面
- [ ] 测试首页
- [ ] 测试展览详情页面
- [ ] 创建统一的图片URL处理函数（可选优化）

## 总结

✅ 已修复所有页面的封面图显示问题
✅ 支持相对路径和绝对路径
✅ 统一处理逻辑

现在展览列表、首页、详情页的图片都能正常显示了！
