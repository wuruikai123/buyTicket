# 后端和前端请求路径完整说明

## 一、后端实际路径结构

### 1. 后端Controller定义
```java
@RestController
@RequestMapping("/api/v1/user")
public class UserController {
    @PostMapping("/login")
    public JsonData login() { ... }
}

@RestController
@RequestMapping("/api/v1/admin/user")
public class AdminUserController {
    @GetMapping("/list")
    public JsonData list() { ... }
}
```

### 2. 后端配置
```properties
server.port=8089
# 注意：没有配置 server.servlet.context-path
```

### 3. 后端实际完整路径
- 用户登录：`http://127.0.0.1:8089/api/v1/user/login`
- 管理员列表：`http://127.0.0.1:8089/api/v1/admin/user/list`
- 展览列表：`http://127.0.0.1:8089/api/v1/exhibition/list`

**结论：后端路径已经包含了 `/api/v1` 前缀！**

---

## 二、前端请求路径

### 1. 前端配置
```typescript
// frontend-a/src/utils/request.ts
const service = axios.create({
  baseURL: '/api/v1',  // 基础路径
  timeout: 10000
})
```

### 2. 前端实际请求
```typescript
// 用户登录
axios.post('/user/login', data)
// 完整路径：/api/v1/user/login

// 展览列表
axios.get('/exhibition/list')
// 完整路径：/api/v1/exhibition/list
```

---

## 三、Nginx 配置原理

### 情况1：后端有 `/api` 前缀（你的情况）

**Nginx 配置：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089;  # 注意：没有尾部斜杠
}
```

**请求流程：**
```
浏览器 → Nginx → 后端
/api/v1/user/login → /api/v1/user/login → http://127.0.0.1:8089/api/v1/user/login ✅
```

**说明：**
- `proxy_pass` 后面**没有斜杠**时，Nginx会保留完整的URI
- 前端请求的 `/api/v1/user/login` 会原封不动地转发给后端

---

### 情况2：后端没有 `/api` 前缀（需要去掉）

**Nginx 配置：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089/;  # 注意：有尾部斜杠
}
```

**请求流程：**
```
浏览器 → Nginx → 后端
/api/v1/user/login → 去掉 /api/ → http://127.0.0.1:8089/v1/user/login
```

**说明：**
- `proxy_pass` 后面**有斜杠**时，Nginx会替换掉 `location` 匹配的部分
- `/api/v1/user/login` 中的 `/api/` 被去掉，变成 `/v1/user/login`

---

## 四、你的正确配置

### 验证后端路径
```bash
# 测试用户登录接口
curl -X POST http://127.0.0.1:8089/api/v1/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'

# 如果返回正常响应（不是404），说明后端路径包含 /api/v1
```

### 正确的 Nginx 配置

**A端配置（5173端口）：**
```nginx
server {
    listen 5173;
    server_name 47.121.192.245;
    root /www/wwwroot/vue/a/dist;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://127.0.0.1:8089;  # 没有尾部斜杠，保留完整路径
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

**B端配置（3001端口）：**
```nginx
server {
    listen 3001;
    server_name 47.121.192.245;
    root /www/wwwroot/vue/b/dist;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://127.0.0.1:8089;  # 没有尾部斜杠
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

**C端配置（5174端口）：**
```nginx
server {
    listen 5174;
    server_name 47.121.192.245;
    root /www/wwwroot/vue/c/dist;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://127.0.0.1:8089;  # 没有尾部斜杠
        proxy_set_header Host $http_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

---

## 五、关键点总结

### 1. 为什么用 `/api/` 作为 location？
- 前端所有API请求都以 `/api/v1` 开头
- 使用 `/api/` 可以匹配所有API请求
- 这样可以把API请求和静态文件请求分开处理

### 2. `proxy_pass` 尾部斜杠的作用

**没有斜杠（保留完整路径）：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089;
}
# /api/v1/user/login → http://127.0.0.1:8089/api/v1/user/login
```

**有斜杠（替换匹配部分）：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089/;
}
# /api/v1/user/login → http://127.0.0.1:8089/v1/user/login
```

### 3. 你的情况
- 后端Controller已经定义了 `/api/v1` 前缀
- 所以Nginx应该**保留完整路径**
- 使用 `proxy_pass http://127.0.0.1:8089;`（没有尾部斜杠）

---

## 六、测试步骤

### 1. 验证后端路径
```bash
# 在服务器上执行
curl -X POST http://127.0.0.1:8089/api/v1/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'
```

### 2. 修改Nginx配置
- 去掉 `proxy_pass` 后面的斜杠
- 改为：`proxy_pass http://127.0.0.1:8089;`

### 3. 重载Nginx
```bash
nginx -t  # 测试配置
nginx -s reload  # 重载配置
```

### 4. 测试前端登录
- 访问 `http://47.121.192.245:5173` (A端)
- 访问 `http://47.121.192.245:3001` (B端)
- 访问 `http://47.121.192.245:5174` (C端)
- 尝试登录，查看是否成功

---

## 七、常见问题

### Q1: 为什么之前看到301重定向？
A: 可能是因为：
- 后端路径末尾缺少斜杠（Spring Boot会自动重定向）
- 或者Nginx配置不正确导致路径不匹配

### Q2: 如何判断应该用哪种配置？
A: 看后端Controller的 `@RequestMapping` 注解：
- 如果包含 `/api`，用 `proxy_pass http://127.0.0.1:8089;`（没有斜杠）
- 如果不包含 `/api`，用 `proxy_pass http://127.0.0.1:8089/;`（有斜杠）

### Q3: 前端需要修改吗？
A: 不需要！前端配置已经正确：
```typescript
baseURL: '/api/v1'
```
只需要修改Nginx配置即可。
