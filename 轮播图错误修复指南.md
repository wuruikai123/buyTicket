# 轮播图错误修复指南

## 问题描述
添加轮播图时出现错误：
```
Error updating database. Cause: java.sql.SQLException: Field 'image_url' doesn't have a default value
```

## 原因分析
数据库中的 `banner` 表仍然是旧的表结构，包含 `image_url` 等旧字段。新的代码使用的是新表结构（只有 `exhibition_id`, `title`, `sort_order`, `status` 等字段）。

## 解决方案

### 方法1：执行安全迁移脚本（推荐）

1. 连接到数据库：
```bash
mysql -u root -p buyticket
```

2. 检查当前表结构：
```sql
DESCRIBE banner;
```

3. 如果看到 `image_url`, `link_type` 等旧字段，执行迁移：
```sql
-- 执行 MIGRATE_BANNER_TABLE_SAFE.sql 中的所有SQL语句
```

### 方法2：手动执行SQL

```sql
-- 1. 删除旧表
DROP TABLE IF EXISTS banner;

-- 2. 创建新表
CREATE TABLE banner (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '轮播图ID',
    exhibition_id BIGINT NOT NULL COMMENT '关联的展览ID',
    title VARCHAR(100) NOT NULL COMMENT '轮播图标题',
    sort_order INT NOT NULL DEFAULT 0 COMMENT '排序号（数字越小越靠前）',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（0:禁用, 1:启用）',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_exhibition_id (exhibition_id),
    INDEX idx_sort_order (sort_order),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='轮播图表';

-- 3. 验证表结构
DESCRIBE banner;
```

### 验证步骤

执行 `DESCRIBE banner;` 后，应该看到以下字段：
- id
- exhibition_id
- title
- sort_order
- status
- create_time
- update_time

**不应该**看到这些旧字段：
- image_url
- link_type
- link_id
- link_url
- subtitle

## 新功能说明

### 自动填充标题
现在当您输入展览ID时，系统会自动：
1. 查询该展览的信息
2. 将展览名称自动填充到"轮播图标题"字段
3. 您可以在此基础上修改标题

### 使用步骤
1. 点击"新增轮播图"
2. 输入展览ID（例如：155）
3. 标题会自动填充为展览名称
4. 您可以修改标题（可选）
5. 设置排序号
6. 点击"确定"

## 重启服务

数据库迁移完成后，重启后端服务：
```bash
# 停止后端
# 重新启动后端
```

## 测试

1. 在B端进入"轮播图管理"
2. 点击"新增轮播图"
3. 输入一个存在的展览ID
4. 观察标题是否自动填充
5. 点击"确定"保存
6. 检查是否成功创建

## 注意事项

- 确保输入的展览ID存在
- 轮播图会使用展览的封面图
- 排序号越小，轮播图越靠前
- 只有"启用"状态的轮播图才会在A端显示
