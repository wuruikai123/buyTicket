# å†…ç½‘ç©¿é€æµ‹è¯•è¯´æ˜

## ä¸€ã€å‡†å¤‡å·¥ä½œ

### 1. å¯åŠ¨åç«¯æœåŠ¡

ç¡®ä¿åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œï¼š

```bash
# ä½¿ç”¨ Docker å¯åŠ¨
docker-compose up -d shared-backend

# æˆ–è€…ç›´æ¥è¿è¡Œ Spring Boot
cd shared-backend
mvn spring-boot:run
```

### 2. ç¡®è®¤ natapp æ­£åœ¨è¿è¡Œ

ç¡®ä¿ä½ çš„ natapp å†…ç½‘ç©¿é€å·¥å…·æ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”æ˜ å°„åˆ°æœ¬åœ°çš„ 8080 ç«¯å£ã€‚

å½“å‰é…ç½®çš„å†…ç½‘ç©¿é€åœ°å€ï¼š`http://z9b46c66.natappfree.cc`

---

## äºŒã€æµ‹è¯•æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

ç›´æ¥è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
# Windows
test-natapp-connection.bat

# Linux/Mac
chmod +x test-natapp-connection.sh
./test-natapp-connection.sh
```

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨æµ‹è¯•

#### 1. æµ‹è¯•æœ¬åœ°è¿æ¥

åœ¨æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œä¸­è®¿é—®ï¼š

```bash
curl http://localhost:8080/api/v1/payment/test/success
```

**é¢„æœŸè¿”å›**ï¼š
```json
{
  "code": 0,
  "msg": "æˆåŠŸ",
  "data": {
    "message": "å†…ç½‘ç©¿é€è¿æ¥æˆåŠŸï¼",
    "timestamp": 1703318400000,
    "natappUrl": "http://z9b46c66.natappfree.cc"
  }
}
```

#### 2. æµ‹è¯•å†…ç½‘ç©¿é€è¿æ¥

åœ¨æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œä¸­è®¿é—®ï¼š

```bash
curl http://z9b46c66.natappfree.cc/api/v1/payment/test/success
```

**é¢„æœŸè¿”å›**ï¼šä¸æœ¬åœ°æµ‹è¯•ç›¸åŒçš„ JSON æ•°æ®

#### 3. æµ‹è¯•æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥æ¥å£

æ¨¡æ‹Ÿæ”¯ä»˜å®å‘é€ POST è¯·æ±‚ï¼š

```bash
curl -X POST http://z9b46c66.natappfree.cc/api/v1/payment/alipay/notify -d "test=1"
```

**é¢„æœŸè¿”å›**ï¼š`failure`ï¼ˆå› ä¸ºç­¾åéªŒè¯å¤±è´¥ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼‰

---

## ä¸‰ã€æµ‹è¯•æ¥å£è¯´æ˜

### æµ‹è¯•æ¥å£

**URL**ï¼š`GET /api/v1/payment/test/success`

**è¯´æ˜**ï¼šè¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•å†…ç½‘ç©¿é€è¿æ¥çš„æ¥å£ï¼Œä¸éœ€è¦ä»»ä½•å‚æ•°ã€‚

**è¿”å›ç¤ºä¾‹**ï¼š
```json
{
  "code": 0,
  "msg": "æˆåŠŸ",
  "data": {
    "message": "å†…ç½‘ç©¿é€è¿æ¥æˆåŠŸï¼",
    "timestamp": 1703318400000,
    "natappUrl": "http://z9b46c66.natappfree.cc"
  }
}
```

### æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥æ¥å£

**URL**ï¼š`POST /api/v1/payment/alipay/notify`

**è¯´æ˜**ï¼šè¿™æ˜¯æ”¯ä»˜å®å›è°ƒçš„æ¥å£ï¼Œæ”¯ä»˜å®æœåŠ¡å™¨ä¼šåœ¨æ”¯ä»˜æˆåŠŸåè°ƒç”¨æ­¤æ¥å£ã€‚

**æµ‹è¯•æ–¹æ³•**ï¼š
```bash
# æ¨¡æ‹Ÿ POST è¯·æ±‚
curl -X POST http://z9b46c66.natappfree.cc/api/v1/payment/alipay/notify -d "test=1"
```

**é¢„æœŸè¿”å›**ï¼š`failure`ï¼ˆå› ä¸ºæ²¡æœ‰æœ‰æ•ˆçš„æ”¯ä»˜å®ç­¾åï¼‰

---

## å››ã€å¸¸è§é—®é¢˜

### 1. è¿æ¥è¶…æ—¶æˆ–æ— æ³•è®¿é—®

**åŸå› **ï¼š
- åç«¯æœåŠ¡æœªå¯åŠ¨
- natapp æœªè¿è¡Œæˆ–é…ç½®é”™è¯¯
- é˜²ç«å¢™æ‹¦æˆª

**è§£å†³**ï¼š
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œï¼š`curl http://localhost:8080/api/v1/payment/test/success`
- æ£€æŸ¥ natapp æ˜¯å¦è¿è¡Œå¹¶æ­£ç¡®æ˜ å°„åˆ° 8080 ç«¯å£
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. natapp åœ°å€å˜åŒ–

natapp å…è´¹ç‰ˆçš„åœ°å€å¯èƒ½ä¼šå˜åŒ–ï¼Œå¦‚æœåœ°å€å˜äº†ï¼Œéœ€è¦æ›´æ–°é…ç½®ï¼š

1. ä¿®æ”¹ `shared-backend/src/main/resources/alipay.properties`ï¼š
   ```properties
   alipay.notifyUrl=http://æ–°çš„natappåœ°å€/api/v1/payment/alipay/notify
   ```

2. é‡å¯åç«¯æœåŠ¡

### 3. æ”¯ä»˜å®å¼‚æ­¥é€šçŸ¥è¿”å› failure

è¿™æ˜¯æ­£å¸¸çš„ï¼å› ä¸ºæµ‹è¯•è¯·æ±‚æ²¡æœ‰æ”¯ä»˜å®çš„ç­¾åï¼Œæ‰€ä»¥ä¼šéªŒè¯å¤±è´¥ã€‚

çœŸå®çš„æ”¯ä»˜å®é€šçŸ¥ä¼šåŒ…å«ç­¾åï¼ŒéªŒè¯é€šè¿‡åä¼šè¿”å› `success`ã€‚

---

## äº”ã€åœ¨æµè§ˆå™¨ä¸­æµ‹è¯•

### ç›´æ¥è®¿é—®æµ‹è¯•æ¥å£

åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ä»¥ä¸‹åœ°å€ï¼š

**æœ¬åœ°æµ‹è¯•**ï¼š
```
http://localhost:8080/api/v1/payment/test/success
```

**å†…ç½‘ç©¿é€æµ‹è¯•**ï¼š
```
http://z9b46c66.natappfree.cc/api/v1/payment/test/success
```

å¦‚æœçœ‹åˆ° JSON æ•°æ®è¿”å›ï¼Œè¯´æ˜è¿æ¥æˆåŠŸï¼

---

## å…­ã€æŸ¥çœ‹åç«¯æ—¥å¿—

æµ‹è¯•æ¥å£è¢«è®¿é—®æ—¶ï¼Œåç«¯ä¼šæ‰“å°æ—¥å¿—ï¼š

```
æµ‹è¯•æ¥å£è¢«è®¿é—® - å†…ç½‘ç©¿é€è¿æ¥æˆåŠŸï¼
```

ä½ å¯ä»¥åœ¨åç«¯æ§åˆ¶å°æˆ– Docker æ—¥å¿—ä¸­æŸ¥çœ‹ï¼š

```bash
# æŸ¥çœ‹ Docker æ—¥å¿—
docker logs -f buyticket-shared-backend-1

# æˆ–è€…æŸ¥çœ‹ Spring Boot æ—¥å¿—
tail -f shared-backend/logs/spring.log
```

---

## ä¸ƒã€ä¸‹ä¸€æ­¥

æµ‹è¯•æˆåŠŸåï¼Œä½ å°±å¯ä»¥ï¼š

1. å¡«å†™æ”¯ä»˜å®é…ç½®ä¿¡æ¯ï¼ˆappIdã€privateKeyã€publicKeyï¼‰
2. åœ¨æ”¯ä»˜å®å¼€æ”¾å¹³å°é…ç½®å¼‚æ­¥é€šçŸ¥åœ°å€ï¼š`http://z9b46c66.natappfree.cc/api/v1/payment/alipay/notify`
3. å¼€å§‹æµ‹è¯•æ”¯ä»˜åŠŸèƒ½

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼** ğŸ‰
