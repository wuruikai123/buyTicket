# 开发环境 vs 生产环境 - 一图看懂

## 📊 环境对比

```
┌─────────────────────────────────────────────────────────────────────┐
│                         开发环境（沙箱）                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  你的电脑                                                            │
│  ┌──────────────────────────────────────────────────────┐          │
│  │                                                      │          │
│  │  前端 (localhost:5173)                               │          │
│  │  ↓                                                   │          │
│  │  后端 (localhost:8080)                               │          │
│  │  ↓                                                   │          │
│  │  natapp (内网穿透)                                   │          │
│  │  http://abc123.natappfree.cc                        │          │
│  │                                                      │          │
│  └──────────────────────────────────────────────────────┘          │
│                          ↓                                          │
│                          ↓                                          │
│  ┌──────────────────────────────────────────────────────┐          │
│  │  支付宝沙箱环境                                       │          │
│  │  https://openapi-sandbox.dl.alipaydev.com           │          │
│  │                                                      │          │
│  │  - 沙箱 APPID: 9021000158671506                     │          │
│  │  - 测试账号: 沙箱提供                                │          │
│  │  - 虚拟支付: 不扣真实资金                            │          │
│  │  - 免费使用                                          │          │
│  └──────────────────────────────────────────────────────┘          │
│                                                                     │
│  ✅ 优点:                                                           │
│    - 免费测试                                                       │
│    - 无需企业认证                                                   │
│    - 快速开发                                                       │
│    - 可以反复测试                                                   │
│                                                                     │
│  ❌ 限制:                                                           │
│    - 不能真实收款                                                   │
│    - 需要内网穿透                                                   │
│    - 回调不稳定                                                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                         生产环境（正式）                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  云服务器 (阿里云/腾讯云)                                            │
│  ┌──────────────────────────────────────────────────────┐          │
│  │                                                      │          │
│  │  前端 (https://www.yourdomain.com)                  │          │
│  │  ↓                                                   │          │
│  │  Nginx (反向代理)                                    │          │
│  │  ↓                                                   │          │
│  │  后端 (localhost:8080)                               │          │
│  │  ↓                                                   │          │
│  │  MySQL 数据库                                        │          │
│  │                                                      │          │
│  └──────────────────────────────────────────────────────┘          │
│                          ↓                                          │
│                          ↓                                          │
│  ┌──────────────────────────────────────────────────────┐          │
│  │  支付宝生产环境                                       │          │
│  │  https://openapi.alipay.com                         │          │
│  │                                                      │          │
│  │  - 真实 APPID: 2021001234567890                     │          │
│  │  - 真实账号: 用户支付宝                              │          │
│  │  - 真实支付: 扣除真实资金                            │          │
│  │  - 手续费: 约 0.6%                                   │          │
│  └──────────────────────────────────────────────────────┘          │
│                                                                     │
│  ✅ 优点:                                                           │
│    - 真实收款                                                       │
│    - 稳定可靠                                                       │
│    - 用户体验好                                                     │
│                                                                     │
│  ❌ 要求:                                                           │
│    - 需要企业认证                                                   │
│    - 需要营业执照                                                   │
│    - 需要支付手续费                                                 │
│    - 需要审核（1-3天）                                              │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## 🔄 切换流程

```
开发阶段
   ↓
┌─────────────────────────────────────┐
│ 1. 使用沙箱环境                      │
│    - 配置 natapp                    │
│    - 修改 notify-url                │
│    - 测试支付流程                    │
└─────────────────────────────────────┘
   ↓
   ↓ 测试通过
   ↓
┌─────────────────────────────────────┐
│ 2. 申请企业认证                      │
│    - 准备营业执照                    │
│    - 注册企业支付宝                  │
│    - 完成认证（1-3天）               │
└─────────────────────────────────────┘
   ↓
   ↓ 认证通过
   ↓
┌─────────────────────────────────────┐
│ 3. 创建生产应用                      │
│    - 登录支付宝开放平台              │
│    - 创建应用                        │
│    - 生成密钥对                      │
│    - 配置回调地址                    │
│    - 签约产品                        │
│    - 提交审核（1-3天）               │
└─────────────────────────────────────┘
   ↓
   ↓ 审核通过
   ↓
┌─────────────────────────────────────┐
│ 4. 修改配置文件                      │
│    - 改 spring.profiles.active=prod │
│    - 配置真实 APPID                  │
│    - 配置真实密钥                    │
│    - 配置真实域名                    │
└─────────────────────────────────────┘
   ↓
   ↓
   ↓
┌─────────────────────────────────────┐
│ 5. 部署到服务器                      │
│    - 打包项目                        │
│    - 上传到服务器                    │
│    - 配置 Nginx                      │
│    - 启动服务                        │
└─────────────────────────────────────┘
   ↓
   ↓
   ↓
┌─────────────────────────────────────┐
│ 6. 测试生产环境                      │
│    - 小额真实支付测试                │
│    - 验证回调                        │
│    - 验证订单状态                    │
└─────────────────────────────────────┘
   ↓
   ↓ 测试通过
   ↓
正式上线 🎉
```

## 📝 配置文件对比

### 开发环境配置

```yaml
# application.yml
spring:
  profiles:
    active: dev  # 👈 开发环境

---
spring:
  config:
    activate:
      on-profile: dev

alipay:
  app-id: 9021000158671506  # 沙箱 APPID
  merchant-private-key: MIIEvQIBADANBgkqhkiG9w0BAQE...  # 沙箱私钥
  alipay-public-key: MIIBIjANBgkqhkiG9w0BAQEFAAO...  # 沙箱公钥
  notify-url: http://abc123.natappfree.cc/api/v1/payment/alipay/notify  # natapp
  return-url: http://localhost:5173/order-success  # 本地
  gateway-url: https://openapi-sandbox.dl.alipaydev.com/gateway.do  # 沙箱网关
```

### 生产环境配置

```yaml
# application.yml
spring:
  profiles:
    active: prod  # 👈 生产环境

---
spring:
  config:
    activate:
      on-profile: prod

alipay:
  app-id: ${ALIPAY_APP_ID}  # 真实 APPID（环境变量）
  merchant-private-key: ${ALIPAY_MERCHANT_PRIVATE_KEY}  # 真实私钥（环境变量）
  alipay-public-key: ${ALIPAY_PUBLIC_KEY}  # 真实公钥（环境变量）
  notify-url: https://www.yourdomain.com/api/v1/payment/alipay/notify  # 真实域名
  return-url: https://www.yourdomain.com/order-success  # 真实域名
  gateway-url: https://openapi.alipay.com/gateway.do  # 生产网关
```

## 🎯 关键区别

| 项目 | 开发环境 | 生产环境 |
|------|---------|---------|
| **配置切换** | `active: dev` | `active: prod` |
| **APPID** | 沙箱 APPID | 真实 APPID |
| **密钥** | 沙箱密钥 | 真实密钥 |
| **回调地址** | natapp 地址 | 真实域名 |
| **网关** | 沙箱网关 | 生产网关 |
| **支付** | 虚拟支付 | 真实支付 |
| **费用** | 免费 | 手续费 0.6% |

## 💡 重要提示

### 代码不需要改！

✅ 只需要修改配置文件 `application.yml`
✅ 切换 `spring.profiles.active` 的值
✅ 配置对应环境的参数

### 安全建议

🔒 生产环境的密钥使用环境变量
🔒 不要把密钥提交到 Git
🔒 定期更换密钥
🔒 使用 HTTPS

### 测试建议

✅ 开发环境充分测试
✅ 生产环境小额测试
✅ 监控支付日志
✅ 设置异常告警

## 🚀 快速切换命令

### Windows

```bash
# 切换到开发环境
switch-environment.bat dev

# 切换到生产环境
switch-environment.bat prod
```

### Linux/Mac

```bash
# 赋予执行权限
chmod +x switch-environment.sh

# 切换到开发环境
./switch-environment.sh dev

# 切换到生产环境
./switch-environment.sh prod
```

## 📞 需要帮助？

查看详细文档：
- `ALIPAY_SANDBOX_VS_PRODUCTION.md` - 沙箱 vs 生产完整说明
- `QUICK_START_GUIDE.md` - 快速开始指南
- `DEPLOYMENT_GUIDE.md` - 完整部署指南
