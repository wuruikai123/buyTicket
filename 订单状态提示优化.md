# 订单状态提示优化

## 优化内容

### 后端优化
**文件**：`AdminOrderController.java`

根据订单状态返回不同的错误信息：

| 状态码 | 状态名称 | 错误提示 |
|--------|----------|----------|
| 0 | 待支付 | "订单未支付，无法核销" |
| 1 | 待使用 | ✅ 可以核销 |
| 2 | 已使用 | "该订单已核销过了" |
| 3 | 已取消 | "订单已取消，无法核销" |
| 其他 | 异常 | "订单状态异常，无法核销" |

### 前端优化

#### OrderVerify.vue（订单号核销）
根据错误信息显示不同的状态：

- **订单不存在**：显示"✗ 订单不存在，请检查订单号"
- **已核销过了**：显示"⚠ 该订单已核销过了"（黄色警告）
- **未支付**：显示"✗ 订单未支付，无法核销"
- **已取消**：显示"✗ 订单已取消，无法核销"

#### ScanVerify.vue（扫码核销）
同样的错误处理逻辑，扫码后自动显示结果。

## 测试用例

### 用例1：正常核销
```
订单号：T1734240000000TEST1（status=1）
预期：✓ 核销成功
```

### 用例2：重复核销
```
订单号：T1734240000000TEST1（status=2）
预期：⚠ 该订单已核销过了
```

### 用例3：未支付订单
```
订单号：TXXXXX（status=0）
预期：✗ 订单未支付，无法核销
```

### 用例4：已取消订单
```
订单号：TXXXXX（status=3）
预期：✗ 订单已取消，无法核销
```

### 用例5：不存在的订单
```
订单号：T9999999999999XXXXX
预期：✗ 订单不存在，请检查订单号
```

## 测试步骤

### 1. 准备测试数据
```sql
-- 创建不同状态的测试订单
INSERT INTO ticket_order (order_no, user_id, total_amount, status, contact_name, contact_phone, create_time)
VALUES 
('T1734240000001TEST', 1, 100.00, 0, '待支付测试', '13800000001', NOW()),
('T1734240000002TEST', 1, 100.00, 1, '待使用测试', '13800000002', NOW()),
('T1734240000003TEST', 1, 100.00, 2, '已使用测试', '13800000003', NOW()),
('T1734240000004TEST', 1, 100.00, 3, '已取消测试', '13800000004', NOW());
```

### 2. 测试订单号核销
1. 访问 http://localhost:5174
2. 登录：seller / 123456
3. 点击"单号核销"
4. 依次测试各个订单号

### 3. 测试扫码核销
1. 生成包含订单号的二维码
2. 点击"扫码核销"
3. 扫描二维码
4. 查看提示信息

## 用户体验

### 成功核销
```
✓ 核销成功
门票订单
有效时间：2025-12-15 14:30
购买账号：用户
订单号码：T1734240000000TEST1
```

### 已核销订单
```
⚠ 该订单已核销过了
门票订单
有效时间：已核销
购买账号：用户
订单号码：T1734240000000TEST1
```

### 订单不存在
```
✗ 订单不存在，请检查订单号
```

### 其他错误
```
✗ 订单未支付，无法核销
✗ 订单已取消，无法核销
```

## 颜色标识

- **绿色（success）**：核销成功
- **黄色（warning）**：已核销过
- **红色（error）**：错误（不存在、未支付、已取消等）

---

**优化完成**：2025-12-15  
**状态**：✅ 已完成  
**测试状态**：⏳ 待验证
