# 图片上传404问题排查指南

## 问题现象
点击上传图片时，浏览器控制台显示：
```
POST http://localhost:3001/api/v1/admin/file/upload 404 (Not Found)
```

## 原因分析
404错误说明：
1. ✅ 前端请求已经发出
2. ✅ Vite代理已经转发到后端（8080端口）
3. ❌ 后端没有找到对应的接口

## 解决步骤

### 步骤1：确认后端服务正在运行
检查后端是否在8080端口运行：
- 查看IDEA或命令行是否有后端服务运行
- 访问 `http://localhost:8080/api/v1/exhibition/list` 测试后端是否正常

### 步骤2：重启后端服务
因为我们刚刚添加了新的文件：
- `AdminFileController.java` - 文件上传接口
- `WebMvcConfig.java` - 静态资源配置
- `application.yml` - 上传路径配置

**必须重启后端服务才能生效！**

### 步骤3：确认文件已编译
如果使用IDEA：
1. 点击 Build → Rebuild Project
2. 确认 `AdminFileController.class` 已生成
3. 重新运行后端服务

如果使用Maven命令行：
```bash
cd shared-backend
mvn clean compile
mvn spring-boot:run
```

### 步骤4：检查Controller路径
确认AdminFileController的完整路径：
```java
@RestController
@RequestMapping("/api/v1/admin/file")
public class AdminFileController {
    
    @PostMapping("/upload")
    public JsonData uploadImage(@RequestParam("file") MultipartFile file) {
        // ...
    }
}
```

完整URL应该是：`POST /api/v1/admin/file/upload`

### 步骤5：检查Spring扫描
确认主类有正确的包扫描：
```java
@SpringBootApplication
@MapperScan("com.buyticket.mapper")
public class BuyTicketApplication {
    // ...
}
```

AdminFileController在 `com.buyticket.controller.admin` 包下，应该会被自动扫描。

### 步骤6：查看后端日志
启动后端时，查看控制台日志，应该能看到类似：
```
Mapped "{[/api/v1/admin/file/upload],methods=[POST]}" onto ...AdminFileController.uploadImage(...)
```

如果没有看到这行日志，说明Controller没有被加载。

## 临时解决方案

如果上传功能一直无法修复，可以使用"输入URL"模式：
1. 在页面上选择"输入URL"单选按钮
2. 直接粘贴图片的网络地址
3. 点击"预览"按钮确认图片可访问
4. 点击"保存配置"

## 验证上传功能

重启后端后，可以用Postman测试上传接口：

**请求：**
- Method: POST
- URL: `http://localhost:8080/api/v1/admin/file/upload`
- Headers: `Authorization: <your-token>`
- Body: form-data
  - Key: `file` (type: File)
  - Value: 选择一张图片

**预期响应：**
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "url": "/uploads/uuid-filename.jpg",
    "filename": "uuid-filename.jpg"
  }
}
```

## 相关文件
- `shared-backend/src/main/java/com/buyticket/controller/admin/AdminFileController.java`
- `shared-backend/src/main/java/com/buyticket/config/WebMvcConfig.java`
- `shared-backend/src/main/resources/application.yml`
- `frontend-b/src/views/system/AboutManagement.vue`

## 常见问题

### Q: 重启后还是404
A: 检查IDEA是否自动编译，或手动执行 `mvn clean compile`

### Q: 上传成功但图片无法访问
A: 检查WebMvcConfig的静态资源映射配置

### Q: 提示"文件不能为空"
A: 检查前端的参数名是否为"file"，与后端@RequestParam一致

### Q: 跨域问题
A: 开发环境使用Vite代理，不应该有跨域问题。如果有，检查vite.config.ts的proxy配置
