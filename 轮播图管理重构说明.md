# 轮播图管理系统重构说明

## 概述
轮播图系统已完全重构，现在轮播图直接关联展览，不再需要单独上传图片。

## 新设计特点

### 1. 数据结构
轮播图表 (banner) 包含以下字段：
- `id`: 轮播图ID
- `exhibition_id`: 关联的展览ID（外键）
- `title`: 轮播图标题
- `sort_order`: 排序号（数字越小越靠前）
- `status`: 状态（0:禁用, 1:启用）
- `create_time`: 创建时间
- `update_time`: 更新时间

### 2. 工作原理
- 轮播图通过 `exhibition_id` 关联展览
- 轮播图显示的图片使用展览的封面图 (`cover_image`)
- 点击轮播图跳转到对应的展览详情页

## 使用说明

### B端管理（添加轮播图）

1. 进入"轮播图管理"页面
2. 点击"新增轮播图"按钮
3. 填写表单：
   - **展览ID**: 输入要关联的展览ID（必填）
     - 输入后，系统会自动查询展览信息
     - 标题会自动填充为展览名称
   - **轮播图标题**: 自动填充展览名称，您可以修改（必填）
   - **排序号**: 数字越小越靠前（必填，默认0）
   - **状态**: 启用/禁用（默认启用）
4. 点击"确定"保存

### 自动填充功能
- 当您输入展览ID后，系统会自动获取展览名称并填充到标题字段
- 您可以在自动填充的基础上修改标题
- 如果展览ID不存在，会提示"未找到该展览"

### 轮播图列表显示
- 展览封面图预览
- 展览ID和名称
- 轮播图标题
- 排序号
- 状态（启用/禁用）
- 操作按钮（编辑/删除）

### A端展示效果
- 轮播图自动显示关联展览的封面图
- 显示轮播图标题
- 点击轮播图跳转到展览详情页
- 按排序号从小到大显示

## 数据库迁移

执行以下SQL文件来更新数据库：
```sql
-- 执行 UPDATE_BANNER_TABLE.sql
-- 这将删除旧的banner表并创建新表结构
```

**注意**: 执行前请备份现有轮播图数据（如果需要保留）

## API接口

### A端接口
- `GET /api/v1/banner/list` - 获取启用的轮播图列表
  - 返回：轮播图信息 + 展览封面图

### B端接口
- `GET /api/v1/admin/banner/list` - 获取轮播图列表（分页）
- `POST /api/v1/admin/banner/create` - 创建轮播图
- `POST /api/v1/admin/banner/update` - 更新轮播图
- `DELETE /api/v1/admin/banner/{id}` - 删除轮播图
- `GET /api/v1/admin/banner/{id}` - 获取轮播图详情

## 文件变更

### 后端
- ✅ `shared-backend/src/main/java/com/buyticket/entity/Banner.java` - 更新实体
- ✅ `shared-backend/src/main/java/com/buyticket/controller/BannerController.java` - A端接口
- ✅ `shared-backend/src/main/java/com/buyticket/controller/admin/AdminBannerController.java` - B端管理接口（新增）

### 前端
- ✅ `frontend-b/src/views/banner/BannerList.vue` - 完全重写，使用表格展示
- ✅ `frontend-a/src/views/Home.vue` - 更新轮播图数据结构

### 数据库
- ✅ `UPDATE_BANNER_TABLE.sql` - 数据库迁移脚本

## 优势

1. **简化管理**: 不需要单独上传轮播图图片
2. **数据一致性**: 轮播图图片与展览封面图保持一致
3. **易于维护**: 修改展览封面图会自动更新轮播图
4. **自动跳转**: 点击轮播图自动跳转到对应展览详情

## 部署步骤

1. **执行数据库迁移**：
   ```bash
   mysql -u root -p buyticket
   ```
   然后执行 `MIGRATE_BANNER_TABLE_SAFE.sql` 中的SQL语句
   
2. **验证表结构**：
   ```sql
   DESCRIBE banner;
   ```
   确保只有新字段：id, exhibition_id, title, sort_order, status, create_time, update_time

3. 重启后端服务

4. 重新构建并部署前端（B端和A端）

5. 在B端添加轮播图：
   - 输入展览ID（标题会自动填充）
   - 可选修改标题
   - 设置排序号
   
6. 在A端查看轮播图效果

## 注意事项

- 确保关联的展览存在且有封面图
- 排序号相同时，按创建时间倒序排列
- 只有状态为"启用"的轮播图才会在A端显示
- 删除展览会自动删除关联的轮播图（外键级联删除）
