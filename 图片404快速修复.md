# 图片404快速修复

## 立即执行（2步）

### 第1步：修改后端配置（已完成✅）

文件已修改：`shared-backend/src/main/java/com/buyticket/config/WebMvcConfig.java`

### 第2步：重启后端服务（必须执行）

停止并重新启动后端服务，使配置生效。

## 验证图片路径

### 1. 检查数据库

在MySQL中执行：
```sql
SELECT id, name, cover_image FROM exhibition ORDER BY id DESC LIMIT 5;
```

**可能的结果**：
```
id | name    | cover_image
1  | 展览A   | /images/exhibition_current.jpg
2  | 展览B   | /uploads/2024/01/xxx.jpg
3  | 展览C   | NULL
```

### 2. 检查文件是否存在

#### Windows:
```cmd
dir shared-backend\uploads
```

#### Linux/Mac:
```bash
ls -la shared-backend/uploads/
```

**应该看到**：
- exhibition_current.jpg
- 或其他图片文件

### 3. 直接访问图片测试

重启后端后，在浏览器中访问：

#### 测试1：/images/ 路径
```
http://localhost:8080/images/exhibition_current.jpg
```

#### 测试2：/uploads/ 路径
```
http://localhost:8080/uploads/exhibition_current.jpg
```

**预期结果**：两个URL都应该能显示图片

## 如果图片文件不存在

### 方案1：上传新图片

1. 登录B端：http://localhost:5174
2. 账号：admin / 123456
3. 进入"展览管理"
4. 编辑展览，重新上传封面图

### 方案2：使用测试图片

创建一个测试图片：
```bash
# 在 shared-backend/uploads/ 目录下
# 放置一张测试图片，命名为 exhibition_current.jpg
```

### 方案3：更新数据库路径

如果图片文件存在但路径不对：
```sql
-- 查看实际的图片文件名
-- 然后更新数据库

UPDATE exhibition 
SET cover_image = '/uploads/实际的文件名.jpg'
WHERE id = 1;
```

## 常见问题

### Q1: 重启后端后还是404？

**检查**：
1. 后端是否真的重启了？
2. 图片文件是否存在？
3. 路径是否正确？

**调试**：
```bash
# 查看后端日志
# 应该看到类似的日志：
# Mapped URL path [/images/**] onto handler
```

### Q2: 图片文件存在但访问不到？

**检查**：文件权限
```bash
# Linux/Mac
chmod 644 shared-backend/uploads/*.jpg

# Windows
# 右键文件 → 属性 → 安全 → 确保有读取权限
```

### Q3: 前端还是显示灰色占位符？

**检查**：
1. 清除浏览器缓存（Ctrl+Shift+Delete）
2. 硬刷新页面（Ctrl+F5）
3. 打开浏览器开发者工具（F12）→ Network标签
4. 刷新页面，查看图片请求的状态码

## 完整测试流程

### 1. 重启后端
```
停止后端 → 启动后端
```

### 2. 测试图片URL
```
http://localhost:8080/images/exhibition_current.jpg
http://localhost:8080/uploads/exhibition_current.jpg
```

### 3. 测试前端页面
```
http://localhost:5173/exhibitions
http://localhost:5173/
```

### 4. 检查浏览器控制台
按F12打开开发者工具，查看：
- Console标签：是否有错误
- Network标签：图片请求的状态码

## 预期结果

✅ 后端重启成功
✅ 图片URL可以直接访问
✅ 前端展览列表显示封面图
✅ 首页显示封面图
✅ 浏览器控制台无404错误

## 如果还是不行

### 临时方案：使用占位图

修改前端，如果图片加载失败，显示占位图：

```vue
<div 
    class="exhibition-image"
    :style="getImageStyle(exhibition.coverImage)"
    @error="handleImageError"
></div>
```

```typescript
const getImageStyle = (coverImage: string | undefined) => {
    if (!coverImage) return {};
    return { backgroundImage: `url(${coverImage})` };
};

const handleImageError = (event: Event) => {
    const target = event.target as HTMLElement;
    target.style.backgroundImage = 'none';
    target.style.backgroundColor = '#d0d0d0';
};
```

## 总结

1. ✅ 后端配置已修改
2. ⏳ 需要重启后端
3. ⏳ 需要验证图片文件存在
4. ⏳ 需要测试图片URL访问

**关键步骤**：重启后端服务！
