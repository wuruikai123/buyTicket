# 单域名部署检查清单

## 📋 使用说明

在部署过程中，按照此清单逐项检查，确保每一步都正确完成。

---

## 第一阶段：准备工作

### ✅ 服务器准备
- [ ] 服务器已购买并可以访问
- [ ] 服务器配置满足要求（最低 2核4G）
- [ ] 已通过 SSH 连接到服务器
- [ ] 服务器防火墙已开放必要端口（80, 443, 8080）

### ✅ 域名准备
- [ ] 域名已购买
- [ ] 域名已完成备案（中国大陆必须）
- [ ] 域名已解析到服务器 IP
- [ ] 域名解析已生效（ping 域名可以解析到服务器 IP）

### ✅ 本地准备
- [ ] 项目代码已下载到本地
- [ ] Node.js 已安装（版本 16+）
- [ ] Maven 已安装（版本 3.6+）
- [ ] Git 已安装

---

## 第二阶段：宝塔面板安装

### ✅ 安装宝塔
- [ ] 已执行宝塔安装命令
- [ ] 安装成功并记录了登录信息
- [ ] 可以访问宝塔面板（http://服务器IP:8888）
- [ ] 已登录宝塔面板
- [ ] 已绑定宝塔账号（可选）

### ✅ 安装软件
- [ ] Nginx 1.22+ 已安装
- [ ] MySQL 8.0 已安装
- [ ] OpenJDK 17 已安装
- [ ] PM2 管理器已安装（可选）
- [ ] phpMyAdmin 已安装（可选）

### ✅ 配置防火墙
- [ ] 端口 80 已开放
- [ ] 端口 443 已开放
- [ ] 端口 8080 已开放（或仅内网）
- [ ] 端口 3306 已开放（或仅内网）

---

## 第三阶段：数据库部署

### ✅ 创建数据库
- [ ] 数据库 `buyticket` 已创建
- [ ] 数据库用户已创建
- [ ] 数据库密码已记录
- [ ] 数据库权限已设置

### ✅ 导入数据
- [ ] 数据库结构已导入（schema.sql）
- [ ] 数据库迁移已执行（添加 order_no, pay_time 等字段）
- [ ] 初始数据已导入（可选）
- [ ] 数据库连接测试成功

---

## 第四阶段：后端部署

### ✅ 上传代码
- [ ] 后端代码已上传到服务器
- [ ] 代码路径：`/www/wwwroot/buyticket/shared-backend`

### ✅ 修改配置
- [ ] `application.yml` 中的数据库配置已修改
- [ ] `application.yml` 中的支付宝配置已修改
- [ ] 域名已替换为真实域名
- [ ] 环境已设置为 `prod`

### ✅ 打包部署
- [ ] 项目已成功打包（mvn clean package）
- [ ] jar 包已生成
- [ ] 后端服务已配置（Java 项目管理器）
- [ ] 后端服务已启动
- [ ] 后端日志显示启动成功
- [ ] 后端端口 8080 已监听

---

## 第五阶段：前端部署

### ✅ 本地构建
- [ ] Frontend-A 已构建（npm run build）
- [ ] Frontend-B 已构建（npm run build）
- [ ] Frontend-C 已构建（npm run build）
- [ ] 所有构建都成功，生成了 dist 目录

### ✅ 上传文件
- [ ] 创建了目录 `/www/wwwroot/buyticket/frontend-a`
- [ ] 创建了目录 `/www/wwwroot/buyticket/frontend-b`
- [ ] 创建了目录 `/www/wwwroot/buyticket/frontend-c`
- [ ] Frontend-A 的 dist 内容已上传到 frontend-a 目录
- [ ] Frontend-B 的 dist 内容已上传到 frontend-b 目录
- [ ] Frontend-C 的 dist 内容已上传到 frontend-c 目录
- [ ] 每个目录都有 index.html 文件
- [ ] 每个目录都有 assets 文件夹

### ✅ 配置网站
- [ ] 已在宝塔面板添加网站
- [ ] 域名已设置为真实域名
- [ ] 根目录已设置为 `/www/wwwroot/buyticket/frontend-a`
- [ ] PHP 版本已设置为"纯静态"

### ✅ 配置 Nginx
- [ ] 已打开网站配置文件
- [ ] 已使用 `nginx-single-domain.conf` 模板
- [ ] 配置中的域名已替换为真实域名
- [ ] 配置中的后端端口已确认（8080）
- [ ] 配置已保存
- [ ] Nginx 已重启

---

## 第六阶段：SSL 证书（推荐）

### ✅ 申请证书
- [ ] 已进入网站 SSL 设置
- [ ] 已选择 Let's Encrypt
- [ ] 证书申请成功
- [ ] 已开启"强制 HTTPS"
- [ ] HTTPS 访问正常

---

## 第七阶段：测试验证

### ✅ 基础访问测试
- [ ] 可以访问用户端：`https://域名/`
- [ ] 可以访问管理端：`https://域名/admin/`
- [ ] 可以访问核销端：`https://域名/verify/`
- [ ] 所有页面样式正常
- [ ] 所有图片加载正常
- [ ] 没有 404 错误

### ✅ API 测试
- [ ] API 可以访问：`https://域名/api/v1/exhibition/list`
- [ ] API 返回正确的 JSON 数据
- [ ] 浏览器控制台没有 CORS 错误
- [ ] 浏览器控制台没有 404 错误

### ✅ 功能测试 - 用户端
- [ ] 可以查看首页
- [ ] 可以浏览展览列表
- [ ] 可以注册新用户
- [ ] 可以登录
- [ ] 可以查看展览详情
- [ ] 可以创建订单
- [ ] 可以进行支付
- [ ] 支付后可以跳转回网站
- [ ] 订单状态正确更新
- [ ] 可以查看订单详情

### ✅ 功能测试 - 管理端
- [ ] 可以访问登录页
- [ ] 可以登录管理员账号
- [ ] 可以查看数据概览
- [ ] 可以管理展览
- [ ] 可以管理商品
- [ ] 可以查看订单
- [ ] 可以管理用户

### ✅ 功能测试 - 核销端
- [ ] 可以访问登录页
- [ ] 可以登录商家账号
- [ ] 可以扫码核销
- [ ] 可以手动输入订单号核销
- [ ] 可以查看核销记录

### ✅ 路由测试
- [ ] 用户端页面刷新不会 404
- [ ] 管理端页面刷新不会 404
- [ ] 核销端页面刷新不会 404
- [ ] 前进后退按钮正常工作

### ✅ 支付测试
- [ ] 可以创建订单
- [ ] 可以跳转到支付宝支付页面
- [ ] 支付成功后可以跳转回网站
- [ ] 订单状态更新为"已支付"
- [ ] 支付宝异步通知正常接收（查看后端日志）

---

## 第八阶段：性能优化（可选）

### ✅ 缓存优化
- [ ] 已开启 Gzip 压缩
- [ ] 静态资源已设置缓存
- [ ] 浏览器缓存策略已配置

### ✅ 安全优化
- [ ] 已禁止访问隐藏文件
- [ ] 已禁止访问备份文件
- [ ] 已设置客户端上传大小限制
- [ ] 已开启 HTTPS
- [ ] 已配置安全响应头（可选）

### ✅ 监控配置
- [ ] 已配置日志记录
- [ ] 可以查看访问日志
- [ ] 可以查看错误日志
- [ ] 已配置监控告警（可选）

---

## 第九阶段：备份配置（重要）

### ✅ 数据备份
- [ ] 已配置数据库自动备份
- [ ] 已配置网站文件备份
- [ ] 已测试备份恢复流程
- [ ] 备份文件已下载到本地

### ✅ 配置备份
- [ ] Nginx 配置已备份
- [ ] 后端配置文件已备份
- [ ] 数据库配置已备份
- [ ] 支付宝配置已备份

---

## 第十阶段：文档整理

### ✅ 记录信息
- [ ] 服务器 IP 已记录
- [ ] 域名已记录
- [ ] 数据库密码已记录
- [ ] 宝塔面板登录信息已记录
- [ ] 支付宝配置信息已记录
- [ ] 管理员账号密码已记录

### ✅ 文档归档
- [ ] 部署文档已整理
- [ ] 配置文件已归档
- [ ] 测试账号已记录
- [ ] 常见问题已记录

---

## 🎯 最终检查

### ✅ 全面测试
- [ ] 所有功能都已测试通过
- [ ] 没有明显的 bug
- [ ] 性能表现良好
- [ ] 用户体验流畅

### ✅ 上线准备
- [ ] 已通知相关人员
- [ ] 已准备好技术支持
- [ ] 已准备好应急预案
- [ ] 已准备好回滚方案

---

## 📊 部署状态

**部署日期**：____年____月____日

**部署人员**：________________

**域名**：________________

**服务器 IP**：________________

**部署状态**：
- [ ] 开发环境
- [ ] 测试环境
- [ ] 生产环境

**备注**：
```
_____________________________________________
_____________________________________________
_____________________________________________
```

---

## 🎉 部署完成

如果所有检查项都已完成，恭喜你！部署成功！

现在你可以：
- ✅ 正式使用系统
- ✅ 接收真实订单
- ✅ 处理真实支付
- ✅ 为用户提供服务

---

## 📞 遇到问题？

如果遇到问题，请按以下顺序排查：

1. **查看日志**
   - Nginx 错误日志：`/www/wwwlogs/buyticket_error.log`
   - 后端日志：`/www/wwwroot/logs/buyticket/application.log`
   - 浏览器控制台

2. **检查配置**
   - Nginx 配置是否正确
   - 后端配置是否正确
   - 域名是否正确

3. **检查服务**
   - 后端服务是否运行
   - Nginx 是否运行
   - 数据库是否运行

4. **查看文档**
   - `单域名部署操作指南.md`
   - `部署快速参考.md`
   - `宝塔面板部署完整指南.md`

---

祝你部署顺利！🚀
