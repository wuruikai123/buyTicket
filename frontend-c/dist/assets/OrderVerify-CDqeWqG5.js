import{d as p,a as n,c as r,b as t,w as h,v as b,F as c,e as _,t as a,u as g,o as u,_ as k}from"./index-hxIbAW9c.js";import{v as T}from"./orders-_NP1vodq.js";import"./request-BZuMAQw0.js";const N={class:"page"},V={class:"content"},w={class:"result"},C={class:"text exhibition-name"},B={class:"text"},D={class:"text"},M={key:0,class:"text"},O={class:"text"},S={class:"text exhibition-name"},F={class:"text"},z={class:"text"},E={key:0,class:"text"},I={class:"text"},L={key:2,class:"text error"},R={key:3,class:"text error"},U={key:4,class:"text muted"},j={class:"footer"},q=["disabled"],A=p({__name:"OrderVerify",setup(G){const m=g(),l=n(""),s=n(null),i=n("idle"),d=n(!1),o=n("");function f(){m.back()}async function y(){if(!(!l.value||d.value)){d.value=!0,o.value="",s.value=null,i.value="idle";try{await T(l.value),s.value={id:0,orderNo:l.value,exhibition:"门票订单",validTime:new Date().toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),buyer:"用户",status:2},i.value="found",setTimeout(()=>{l.value=""},2e3)}catch(v){console.error("核销失败:",v);const e=v.message||v.toString();e.includes("订单不存在")?(i.value="notfound",o.value="订单不存在，请检查订单号"):e.includes("已核销过了")||e.includes("已核销")?(i.value="verified",s.value={id:0,orderNo:l.value,exhibition:"门票订单",validTime:"已核销",buyer:"用户",status:2},o.value="该订单已核销过了"):e.includes("未支付")?(i.value="error",o.value="订单未支付，无法核销"):e.includes("已取消")?(i.value="error",o.value="订单已取消，无法核销"):e.includes("请输入订单号")?(i.value="error",o.value="请输入订单号"):(i.value="error",o.value=e||"核销失败，请重试")}finally{d.value=!1}}}return(v,e)=>(u(),r("div",N,[t("header",{class:"topbar"},[t("button",{class:"back","aria-label":"返回",onClick:f},"‹"),e[1]||(e[1]=t("div",{class:"title"},"输入订单号",-1)),e[2]||(e[2]=t("div",{class:"placeholder"},null,-1))]),t("main",V,[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=x=>l.value=x),class:"input",type:"text",placeholder:"请输入订单号",inputmode:"numeric",autocomplete:"one-time-code"},null,512),[[b,l.value,void 0,{trim:!0}]]),t("div",w,[e[5]||(e[5]=t("div",{class:"result-title"},"查询结果",-1)),i.value==="found"&&s.value?(u(),r(c,{key:0},[e[3]||(e[3]=t("div",{class:"text success"},"✓ 核销成功",-1)),t("div",C,a(s.value.exhibition),1),t("div",B,"有效时间："+a(s.value.validTime),1),t("div",D,"购买账号："+a(s.value.buyer),1),s.value.verifyTime?(u(),r("div",M,"核销时间："+a(s.value.verifyTime),1)):_("",!0),t("div",O,"订单号码："+a(s.value.orderNo),1)],64)):i.value==="verified"&&s.value?(u(),r(c,{key:1},[e[4]||(e[4]=t("div",{class:"text warning"},"⚠ 该订单已核销",-1)),t("div",S,a(s.value.exhibition),1),t("div",F,"有效时间："+a(s.value.validTime),1),t("div",z,"购买账号："+a(s.value.buyer),1),s.value.verifyTime?(u(),r("div",E,"核销时间："+a(s.value.verifyTime),1)):_("",!0),t("div",I,"订单号码："+a(s.value.orderNo),1)],64)):i.value==="notfound"?(u(),r("div",L,"✗ 未查询到订单")):i.value==="error"?(u(),r("div",R,"✗ "+a(o.value),1)):(u(),r("div",U,"请输入订单号后点击核销"))])]),t("footer",j,[t("button",{class:"primary",disabled:!l.value||d.value,onClick:y},a(d.value?"核销中...":"核销"),9,q)])]))}}),P=k(A,[["__scopeId","data-v-a30c12d4"]]);export{P as default};
