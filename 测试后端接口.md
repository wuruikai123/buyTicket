# 测试后端接口命令

## 问题分析

从访问日志看到：
```
POST /api/v1/admin/auth/login HTTP/1.1" 301 162
```

**301 重定向**说明：
1. 后端路径存在
2. 但是路径格式不对（可能缺少或多了尾部斜杠）

## 测试命令

### 1. 测试管理员登录（不带尾部斜杠）
```bash
curl -v -X POST http://127.0.0.1:8089/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 2. 测试管理员登录（带尾部斜杠）
```bash
curl -v -X POST http://127.0.0.1:8089/api/v1/admin/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

### 3. 测试用户登录（对比）
```bash
curl -v -X POST http://127.0.0.1:8089/api/v1/user/login \
  -H "Content-Type: application/json" \
  -d '{"username":"test","password":"123456"}'
```

## 预期结果

### 如果返回 200
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "token": "xxx",
    "admin": {...}
  }
}
```
或者
```json
{
  "code": -1,
  "msg": "用户名或密码错误"
}
```

### 如果返回 301
```
< HTTP/1.1 301 Moved Permanently
< Location: /api/v1/admin/auth/login/
```
说明需要加尾部斜杠

### 如果返回 404
```
< HTTP/1.1 404 Not Found
```
说明路径不存在

## 根据测试结果修改 Nginx

### 情况A：后端路径是 `/api/v1/admin/auth/login`（不带斜杠）

**Nginx 配置：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089;  # 不带斜杠，保留完整路径
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```

### 情况B：后端路径是 `/v1/admin/auth/login`（没有 /api 前缀）

**Nginx 配置：**
```nginx
location /api/ {
    proxy_pass http://127.0.0.1:8089/;  # 带斜杠，去掉 /api/
    proxy_set_header Host $http_host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
}
```

## 快速诊断

在服务器上执行：
```bash
# 查看后端日志
tail -f /path/to/backend/logs/application.log

# 同时在另一个终端测试
curl -v -X POST http://127.0.0.1:8089/api/v1/admin/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

观察：
1. 返回状态码（200/301/404）
2. 后端日志是否有请求记录
3. 如果有301，看 Location 头指向哪里
