# 订单作废功能说明

## 完成的修改

### 1. B端侧边栏调整
✅ 删除"库存预警"菜单项
✅ 将"库存管理"改名为"销售记录"

### 2. B端销售记录页面（原库存管理）
✅ 页面标题改为"销售记录"
✅ 添加订单状态筛选（待使用/已使用/已作废）
✅ 显示所有订单（不再只显示已核销订单）
✅ 添加"作废"按钮（待使用和已使用的订单可作废）
✅ 移除"重置"和"删除"按钮
✅ 显示订单状态标签

### 3. C端页面调整
✅ 首页按钮从"核销记录"改为"销售记录"
✅ Records页面标题改为"销售记录"

### 4. 后端接口
✅ 添加作废接口：`POST /api/v1/admin/order/ticket/{id}/void`
- 只能作废待使用(1)或已使用(2)的订单
- 作废后订单状态变为4（已作废）
- 不可恢复

### 5. A端用户界面
✅ 订单状态映射添加"已作废"(状态4)
✅ 已作废订单可以删除
✅ 个人中心正确显示"已作废"状态

## 订单状态说明

| 状态码 | 状态名称 | 说明 | 可执行操作 |
|--------|---------|------|-----------|
| 0 | 待支付 | 订单已创建，未支付 | 取消、删除 |
| 1 | 待使用 | 已支付，未核销 | 核销、作废 |
| 2 | 已使用 | 已核销 | 重置、作废、删除 |
| 3 | 已取消 | 用户取消订单 | 删除 |
| 4 | 已作废 | 管理员作废 | 删除 |

## 使用流程

### B端作废订单
1. 进入"门票管理" → "销售记录"
2. 找到需要作废的订单（待使用或已使用状态）
3. 点击"作废"按钮
4. 确认作废操作
5. 订单状态变为"已作废"

### A端查看作废订单
1. 用户登录后进入"个人中心"
2. 在"我的门票订单"中查看
3. 已作废订单显示"已作废"状态
4. 用户可以删除已作废的订单

## 注意事项

1. **作废操作不可恢复**：一旦作废，订单无法恢复为待使用或已使用状态
2. **作废条件**：只有待使用(1)和已使用(2)的订单可以作废
3. **用户影响**：作废后用户无法使用该门票，建议在作废前与用户沟通
4. **删除权限**：已作废订单用户可以自行删除

## 相关文件

### 前端
- `frontend-b/src/layouts/MainLayout.vue` - B端侧边栏
- `frontend-b/src/views/ticket/InventoryList.vue` - 销售记录页面
- `frontend-c/src/views/Home.vue` - C端首页
- `frontend-c/src/views/Records.vue` - C端销售记录
- `frontend-a/src/views/Profile.vue` - A端个人中心

### 后端
- `shared-backend/src/main/java/com/buyticket/controller/admin/AdminOrderController.java` - 作废接口

## 数据库

订单状态字段：`ticket_order.status`
- 类型：TINYINT
- 值：0=待支付, 1=待使用, 2=已使用, 3=已取消, 4=已作废
