# 轮播图问题解决方案

## 问题
1. 添加轮播图报错：`Field 'image_url' doesn't have a default value`
2. 需要根据展览ID自动填充标题

## 已完成的修复

### 1. 数据库迁移脚本
创建了 `MIGRATE_BANNER_TABLE_SAFE.sql` - 安全迁移到新表结构

### 2. 自动填充功能
- ✅ 输入展览ID后自动查询展览信息
- ✅ 自动填充展览名称到标题字段
- ✅ 用户可以修改自动填充的标题
- ✅ 展览不存在时显示提示

### 3. 前端优化
- ✅ 添加展览ID输入监听
- ✅ 添加自动填充提示文字
- ✅ 优化用户体验

## 立即执行的步骤

### 第一步：修复数据库（最重要！）

```bash
# 1. 连接数据库
mysql -u root -p buyticket

# 2. 检查当前表结构
DESCRIBE banner;

# 3. 如果看到 image_url 等旧字段，执行以下SQL：
DROP TABLE IF EXISTS banner;

CREATE TABLE banner (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '轮播图ID',
    exhibition_id BIGINT NOT NULL COMMENT '关联的展览ID',
    title VARCHAR(100) NOT NULL COMMENT '轮播图标题',
    sort_order INT NOT NULL DEFAULT 0 COMMENT '排序号（数字越小越靠前）',
    status TINYINT NOT NULL DEFAULT 1 COMMENT '状态（0:禁用, 1:启用）',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_exhibition_id (exhibition_id),
    INDEX idx_sort_order (sort_order),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='轮播图表';

# 4. 验证新表结构
DESCRIBE banner;
# 应该只看到: id, exhibition_id, title, sort_order, status, create_time, update_time
```

### 第二步：重启后端

```bash
# 停止后端服务
# 重新启动后端服务
```

### 第三步：测试新功能

1. 打开B端 → 轮播图管理
2. 点击"新增轮播图"
3. 输入展览ID（例如：155）
4. 观察标题是否自动填充
5. 可选修改标题
6. 设置排序号
7. 点击"确定"

## 新功能演示

```
输入展览ID: 155
↓ (自动查询)
标题自动填充: "逐梦星辰：中国航天成就展"
↓ (用户可修改)
最终标题: "逐梦星辰：中国航天成就展" 或 "123"（用户修改后）
```

## 相关文件

- `MIGRATE_BANNER_TABLE_SAFE.sql` - 数据库迁移脚本
- `轮播图错误修复指南.md` - 详细修复指南
- `轮播图管理重构说明.md` - 完整功能说明
- `frontend-b/src/views/banner/BannerList.vue` - B端管理页面（已更新）
- `shared-backend/src/main/java/com/buyticket/controller/admin/AdminBannerController.java` - 后端接口

## 验证清单

- [ ] 数据库表结构已更新（无 image_url 字段）
- [ ] 后端服务已重启
- [ ] 可以成功添加轮播图
- [ ] 输入展览ID后标题自动填充
- [ ] 可以修改自动填充的标题
- [ ] 轮播图在A端正常显示
- [ ] 点击轮播图可以跳转到展览详情

## 注意事项

1. **必须先执行数据库迁移**，否则会继续报错
2. 确保输入的展览ID存在
3. 标题自动填充后可以修改
4. 排序号越小，轮播图越靠前
