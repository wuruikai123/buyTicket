# 展览表单图片上传修复说明

## 修复内容

### 问题描述

1. 图片上传位显示为长方形，不是正方形
2. 已上传的图片无法删除
3. 图片上传位的+和X按钮逻辑混乱

### 解决方案

**文件：** `frontend-b/src/views/exhibition/ExhibitionForm.vue`

#### 1. 图片上传区域重新设计

**两个主要图片上传位（200x200正方形）：**

- **封面图（coverImage）**
  - 用途：在A端列表页显示
  - 尺寸：200x200px
  - 位置：表单左侧第一个

- **详情图（detailCoverImage）**
  - 用途：在A端详情页左上角显示
  - 尺寸：200x200px
  - 位置：表单左侧第二个

**介绍插图（6个上传位，120x120正方形）：**
- 用途：在A端详情页展示展览介绍图片
- 尺寸：120x120px
- 数量：6个独立上传位

#### 2. 上传和删除逻辑

**未上传状态：**
- 显示虚线边框的正方形框
- 中间显示+号图标
- 点击可以上传图片

**已上传状态：**
- 显示上传的图片
- 鼠标悬停时显示半透明黑色遮罩
- 遮罩中间显示X图标
- 点击X可以删除图片

#### 3. 样式优化

**边框样式：**
- 未上传：虚线边框（dashed）
- 颜色：#dcdfe6
- 悬停时：#409eff

**图标样式：**
- +号：48px（主图）/ 32px（插图）
- X号：24px，白色，悬停时变红色

**遮罩效果：**
- 背景：rgba(0, 0, 0, 0.5)
- 默认透明度：0
- 悬停时透明度：1
- 过渡动画：0.3s

---

## 代码变更

### 1. 添加新字段

```typescript
const form = reactive({
  name: '',
  shortDesc: '',
  description: '',
  startDate: '',
  endDate: '',
  price: 0,
  coverImage: '',           // 封面图
  detailCoverImage: '',     // 详情图（新增）
  tags: [] as string[],
  status: 0
})
```

### 2. 新增上传和删除方法

```typescript
// 封面图上传
const beforeCoverUpload = (file: File) => {
  const reader = new FileReader()
  reader.onload = (e) => {
    form.coverImage = e.target?.result as string
  }
  reader.readAsDataURL(file)
  return false
}

// 详情图上传
const beforeDetailCoverUpload = (file: File) => {
  const reader = new FileReader()
  reader.onload = (e) => {
    form.detailCoverImage = e.target?.result as string
  }
  reader.readAsDataURL(file)
  return false
}

// 删除封面图
const handleRemoveCoverImage = () => {
  form.coverImage = ''
}

// 删除详情图
const handleRemoveDetailCoverImage = () => {
  form.detailCoverImage = ''
}

// 删除介绍插图
const handleRemoveDetailImage = (index: number) => {
  detailImagesList.value[index].url = ''
}
```

### 3. 模板结构

```vue
<!-- 封面图 -->
<el-form-item label="封面图" prop="coverImage">
  <el-upload :before-upload="beforeCoverUpload">
    <div v-if="form.coverImage" class="image-preview">
      <img :src="form.coverImage" />
      <div class="image-overlay">
        <el-icon @click.stop="handleRemoveCoverImage"><Close /></el-icon>
      </div>
    </div>
    <div v-else class="image-placeholder">
      <el-icon><Plus /></el-icon>
    </div>
  </el-upload>
</el-form-item>

<!-- 详情图 -->
<el-form-item label="详情图" prop="detailCoverImage">
  <el-upload :before-upload="beforeDetailCoverUpload">
    <div v-if="form.detailCoverImage" class="image-preview">
      <img :src="form.detailCoverImage" />
      <div class="image-overlay">
        <el-icon @click.stop="handleRemoveDetailCoverImage"><Close /></el-icon>
      </div>
    </div>
    <div v-else class="image-placeholder">
      <el-icon><Plus /></el-icon>
    </div>
  </el-upload>
</el-form-item>

<!-- 介绍插图 -->
<div v-for="(item, index) in detailImagesList" :key="index">
  <el-upload v-if="!item.url" :before-upload="(file) => handleDetailImageUpload(file, index)">
    <div class="detail-image-placeholder">
      <el-icon><Plus /></el-icon>
    </div>
  </el-upload>
  <div v-else class="image-preview">
    <img :src="item.url" />
    <div class="image-overlay">
      <el-icon @click="handleRemoveDetailImage(index)"><Close /></el-icon>
    </div>
  </div>
</div>
```

---

## 使用说明

### 上传图片

1. **封面图和详情图：**
   - 点击带+号的正方形框
   - 选择图片文件
   - 图片会自动显示在框内

2. **介绍插图：**
   - 点击任意一个带+号的小方框
   - 选择图片文件
   - 图片会显示在对应位置

### 删除图片

1. 鼠标悬停在已上传的图片上
2. 会出现半透明黑色遮罩和X图标
3. 点击X图标即可删除图片
4. 删除后该位置恢复为+号状态

### 保存表单

- 点击底部"保存"按钮
- 系统会验证必填字段
- 保存成功后跳转到展览列表页

---

## 注意事项

### 1. 图片格式

- 支持的格式：JPG、PNG、GIF
- 建议尺寸：
  - 封面图/详情图：至少 400x400px
  - 介绍插图：至少 240x240px
- 文件大小：建议不超过 2MB

### 2. 图片存储

- 当前使用 Base64 编码存储
- 图片数据保存在表单的字符串字段中
- 未来可以改为上传到服务器或OSS

### 3. 必填字段

- 封面图是必填的
- 详情图是可选的
- 介绍插图是可选的

### 4. 编辑模式

- 编辑展览时会自动加载已保存的图片
- 可以删除原有图片重新上传
- 也可以保持原有图片不变

---

## 后续优化建议

### 1. 图片上传到服务器

当前图片使用Base64存储在数据库中，建议改为：

```typescript
// 上传到服务器
const uploadToServer = async (file: File) => {
  const formData = new FormData()
  formData.append('file', file)
  
  const response = await fetch('/api/v1/upload/image', {
    method: 'POST',
    body: formData
  })
  
  const data = await response.json()
  return data.url // 返回图片URL
}
```

### 2. 图片裁剪功能

可以添加图片裁剪功能，确保上传的图片比例正确：

```bash
npm install vue-cropper
```

### 3. 图片压缩

上传前压缩图片，减少存储空间：

```bash
npm install compressorjs
```

### 4. 拖拽上传

支持拖拽文件到上传区域：

```vue
<el-upload
  drag
  :before-upload="beforeUpload"
>
  <!-- ... -->
</el-upload>
```

### 5. 批量上传

支持一次选择多个文件批量上传到介绍插图：

```vue
<el-upload
  multiple
  :limit="6"
  :on-exceed="handleExceed"
>
  <!-- ... -->
</el-upload>
```

---

## 测试清单

### 功能测试

- [ ] 封面图上传正常
- [ ] 详情图上传正常
- [ ] 介绍插图上传正常（6个位置）
- [ ] 封面图删除正常
- [ ] 详情图删除正常
- [ ] 介绍插图删除正常
- [ ] 图片显示比例正确（正方形）
- [ ] 悬停效果正常（遮罩和X图标）
- [ ] 保存后图片数据正确

### 样式测试

- [ ] 未上传状态显示+号
- [ ] 已上传状态显示图片
- [ ] 边框样式正确（虚线）
- [ ] 悬停时边框变蓝色
- [ ] 遮罩透明度过渡流畅
- [ ] X图标悬停时变红色

### 兼容性测试

- [ ] Chrome浏览器正常
- [ ] Edge浏览器正常
- [ ] Firefox浏览器正常
- [ ] Safari浏览器正常

### 边界测试

- [ ] 上传超大图片（>5MB）
- [ ] 上传非图片文件
- [ ] 快速连续上传多张图片
- [ ] 上传后立即删除
- [ ] 编辑模式加载已有图片

---

## 版本信息

- 修改日期：2026-01-30
- 修改人：Kiro AI
- 版本：v1.3
- 功能：展览表单图片上传优化

