# å•åŸŸåéƒ¨ç½²æ“ä½œæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ åœ¨å®å¡”é¢æ¿ä¸Šä½¿ç”¨**å•ä¸ªåŸŸå**éƒ¨ç½²ä¸‰ä¸ªå‰ç«¯é¡¹ç›®å’Œä¸€ä¸ªåç«¯æœåŠ¡ã€‚

**éƒ¨ç½²æ¶æ„**ï¼š
```
åŸŸå: www.example.com
â”œâ”€â”€ /              â†’ Frontend-A (ç”¨æˆ·ç«¯)
â”œâ”€â”€ /admin/        â†’ Frontend-B (ç®¡ç†ç«¯)  
â”œâ”€â”€ /verify/       â†’ Frontend-C (æ ¸é”€ç«¯)
â””â”€â”€ /api/          â†’ Backend (åç«¯API)
```

---

## âœ… å·²å®Œæˆçš„é…ç½®ä¿®æ”¹

ä»¥ä¸‹æ–‡ä»¶å·²ç»è‡ªåŠ¨ä¿®æ”¹å®Œæˆï¼Œ**æ— éœ€æ‰‹åŠ¨ä¿®æ”¹**ï¼š

### 1. Vite é…ç½®æ–‡ä»¶
- âœ… `frontend-a/vite.config.ts` - è®¾ç½® `base: '/'`
- âœ… `frontend-b/vite.config.ts` - è®¾ç½® `base: '/admin/'`
- âœ… `frontend-c/vite.config.ts` - è®¾ç½® `base: '/verify/'`

### 2. API è¯·æ±‚é…ç½®
- âœ… `frontend-a/src/utils/request.ts` - ä½¿ç”¨ `baseURL: '/api/v1'`
- âœ… `frontend-b/src/utils/request.ts` - ä½¿ç”¨ `baseURL: '/api/v1'`
- âœ… `frontend-c/src/utils/request.ts` - ä½¿ç”¨ `baseURL: '/api/v1/admin'`

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæœ¬åœ°æ„å»ºå‰ç«¯é¡¹ç›®

åœ¨æœ¬åœ°ç”µè„‘ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. æ„å»ºç”¨æˆ·ç«¯ (Frontend-A)
cd frontend-a
npm install
npm run build
# ç”Ÿæˆ dist ç›®å½•

# 2. æ„å»ºç®¡ç†ç«¯ (Frontend-B)
cd ../frontend-b
npm install
npm run build
# ç”Ÿæˆ dist ç›®å½•

# 3. æ„å»ºæ ¸é”€ç«¯ (Frontend-C)
cd ../frontend-c
npm install
npm run build
# ç”Ÿæˆ dist ç›®å½•
```

æ„å»ºå®Œæˆåï¼Œæ¯ä¸ªå‰ç«¯é¡¹ç›®éƒ½ä¼šç”Ÿæˆä¸€ä¸ª `dist` ç›®å½•ã€‚

---

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨

#### æ–¹æ³•1ï¼šä½¿ç”¨å®å¡”é¢æ¿ä¸Šä¼ ï¼ˆæ¨èï¼‰

1. ç™»å½•å®å¡”é¢æ¿
2. ç‚¹å‡»"æ–‡ä»¶"èœå•
3. è¿›å…¥ `/www/wwwroot/` ç›®å½•
4. åˆ›å»ºé¡¹ç›®ç›®å½•ï¼š
   ```
   /www/wwwroot/buyticket/
   â”œâ”€â”€ frontend-a/
   â”œâ”€â”€ frontend-b/
   â””â”€â”€ frontend-c/
   ```
5. åˆ†åˆ«ä¸Šä¼ æ¯ä¸ªå‰ç«¯çš„ `dist` ç›®å½•å†…å®¹åˆ°å¯¹åº”æ–‡ä»¶å¤¹

**é‡è¦**ï¼šä¸Šä¼ çš„æ˜¯ `dist` ç›®å½•**é‡Œé¢çš„å†…å®¹**ï¼Œä¸æ˜¯ `dist` ç›®å½•æœ¬èº«ï¼

ä¸Šä¼ åçš„ç›®å½•ç»“æ„åº”è¯¥æ˜¯ï¼š
```
/www/wwwroot/buyticket/
â”œâ”€â”€ frontend-a/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ frontend-b/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/
â”‚   â””â”€â”€ ...
â””â”€â”€ frontend-c/
    â”œâ”€â”€ index.html
    â”œâ”€â”€ assets/
    â””â”€â”€ ...
```

#### æ–¹æ³•2ï¼šä½¿ç”¨ FTP å·¥å…·

ä½¿ç”¨ FileZilla ç­‰ FTP å·¥å…·ä¸Šä¼ åˆ°ç›¸åŒçš„ç›®å½•ç»“æ„ã€‚

---

### ç¬¬ä¸‰æ­¥ï¼šé…ç½® Nginx

1. åœ¨å®å¡”é¢æ¿ç‚¹å‡»"ç½‘ç«™"
2. ç‚¹å‡»"æ·»åŠ ç«™ç‚¹"
3. å¡«å†™ä¿¡æ¯ï¼š
   - **åŸŸå**ï¼š`www.example.com`ï¼ˆæ”¹ä¸ºä½ çš„çœŸå®åŸŸåï¼‰
   - **æ ¹ç›®å½•**ï¼š`/www/wwwroot/buyticket/frontend-a`
   - **PHPç‰ˆæœ¬**ï¼šçº¯é™æ€
4. ç‚¹å‡»"æäº¤"

5. ç‚¹å‡»ç½‘ç«™å³ä¾§çš„"è®¾ç½®"
6. ç‚¹å‡»"é…ç½®æ–‡ä»¶"
7. **å®Œæ•´æ›¿æ¢**ä¸ºä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    listen 443 ssl http2;
    server_name www.example.com;  # ğŸ‘ˆ æ”¹ä¸ºä½ çš„åŸŸå
    
    # SSL è¯ä¹¦é…ç½®ï¼ˆå®å¡”ä¼šè‡ªåŠ¨æ·»åŠ ï¼‰
    # ssl_certificate ...
    # ssl_certificate_key ...
    
    # å¼ºåˆ¶ HTTPSï¼ˆå¯é€‰ï¼Œå»ºè®®å¼€å¯ï¼‰
    # if ($server_port !~ 443){
    #     rewrite ^(/.*)$ https://$host$1 permanent;
    # }
    
    # æ—¥å¿—
    access_log /www/wwwlogs/buyticket_access.log;
    error_log /www/wwwlogs/buyticket_error.log;
    
    # æ ¹ç›®å½• - Frontend-A (ç”¨æˆ·ç«¯)
    location / {
        root /www/wwwroot/buyticket/frontend-a;
        index index.html;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜é™æ€èµ„æº
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            expires 7d;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # ç®¡ç†ç«¯ - Frontend-B
    location /admin {
        alias /www/wwwroot/buyticket/frontend-b;
        index index.html;
        try_files $uri $uri/ /admin/index.html;
        
        location ~* ^/admin/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            alias /www/wwwroot/buyticket/frontend-b;
            expires 7d;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # æ ¸é”€ç«¯ - Frontend-C
    location /verify {
        alias /www/wwwroot/buyticket/frontend-c;
        index index.html;
        try_files $uri $uri/ /verify/index.html;
        
        location ~* ^/verify/.*\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            alias /www/wwwroot/buyticket/frontend-c;
            expires 7d;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8080;  # ğŸ‘ˆ ç¡®è®¤åç«¯ç«¯å£æ˜¯ 8080
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
    }
}
```

8. ç‚¹å‡»"ä¿å­˜"
9. ç‚¹å‡»"é‡è½½é…ç½®"

---

### ç¬¬å››æ­¥ï¼šé…ç½®åç«¯

1. ä¿®æ”¹åç«¯é…ç½®æ–‡ä»¶ `shared-backend/src/main/resources/application.yml`ï¼š

```yaml
alipay:
  notify-url: https://www.example.com/api/v1/payment/alipay/notify  # ğŸ‘ˆ æ”¹ä¸ºä½ çš„åŸŸå
  return-url: https://www.example.com/order-success  # ğŸ‘ˆ æ”¹ä¸ºä½ çš„åŸŸå
```

2. é‡æ–°æ‰“åŒ…åç«¯ï¼š
```bash
cd shared-backend
mvn clean package -DskipTests
```

3. ä¸Šä¼  `target/buyticket-0.0.1-SNAPSHOT.jar` åˆ°æœåŠ¡å™¨

4. åœ¨å®å¡”é¢æ¿å¯åŠ¨åç«¯æœåŠ¡ï¼ˆå‚è€ƒã€Šå®å¡”é¢æ¿éƒ¨ç½²å®Œæ•´æŒ‡å—.mdã€‹ï¼‰

---

### ç¬¬äº”æ­¥ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆæ¨èï¼‰

1. åœ¨å®å¡”é¢æ¿ç‚¹å‡»ç½‘ç«™ â†’ "è®¾ç½®"
2. ç‚¹å‡»"SSL"æ ‡ç­¾
3. é€‰æ‹©"Let's Encrypt"
4. å‹¾é€‰ä½ çš„åŸŸå
5. ç‚¹å‡»"ç”³è¯·"
6. ç”³è¯·æˆåŠŸåï¼Œå¼€å¯"å¼ºåˆ¶ HTTPS"

---

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•éªŒè¯

è®¿é—®ä»¥ä¸‹åœ°å€è¿›è¡Œæµ‹è¯•ï¼š

1. **ç”¨æˆ·ç«¯**ï¼š`https://www.example.com/`
   - åº”è¯¥èƒ½çœ‹åˆ°é¦–é¡µ
   - å¯ä»¥æµè§ˆå±•è§ˆ
   - å¯ä»¥æ³¨å†Œç™»å½•

2. **ç®¡ç†ç«¯**ï¼š`https://www.example.com/admin/`
   - åº”è¯¥èƒ½çœ‹åˆ°ç®¡ç†åå°ç™»å½•é¡µ
   - å¯ä»¥ç™»å½•ç®¡ç†

3. **æ ¸é”€ç«¯**ï¼š`https://www.example.com/verify/`
   - åº”è¯¥èƒ½çœ‹åˆ°æ ¸é”€ç«¯ç™»å½•é¡µ
   - å¯ä»¥æ‰«ç æ ¸é”€

4. **APIæµ‹è¯•**ï¼š`https://www.example.com/api/v1/exhibition/list`
   - åº”è¯¥è¿”å›å±•è§ˆåˆ—è¡¨ JSON æ•°æ®

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šè®¿é—®ç®¡ç†ç«¯æˆ–æ ¸é”€ç«¯å‡ºç° 404

**åŸå› **ï¼šNginx é…ç½®ä¸æ­£ç¡®æˆ–æ–‡ä»¶è·¯å¾„é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ `alias` è·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸Šä¼ åˆ°æ­£ç¡®çš„ç›®å½•
3. æ£€æŸ¥ `try_files` é…ç½®æ˜¯å¦æ­£ç¡®
4. é‡å¯ Nginx

### é—®é¢˜2ï¼šé™æ€èµ„æºï¼ˆCSS/JSï¼‰åŠ è½½å¤±è´¥

**åŸå› **ï¼š`base` è·¯å¾„é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `vite.config.ts` ä¸­çš„ `base` é…ç½®æ­£ç¡®
2. é‡æ–°æ„å»ºå‰ç«¯é¡¹ç›®
3. é‡æ–°ä¸Šä¼ 

### é—®é¢˜3ï¼šAPI è¯·æ±‚å¤±è´¥

**åŸå› **ï¼šåç«¯æœªå¯åŠ¨æˆ– Nginx ä»£ç†é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯æ˜¯å¦åœ¨ 8080 ç«¯å£è¿è¡Œï¼š`netstat -tunlp | grep 8080`
2. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ `proxy_pass` ç«¯å£æ˜¯å¦æ­£ç¡®
3. æŸ¥çœ‹åç«¯æ—¥å¿—
4. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼š`/www/wwwlogs/buyticket_error.log`

### é—®é¢˜4ï¼šé¡µé¢åˆ·æ–°å 404

**åŸå› **ï¼šå‰ç«¯è·¯ç”±é…ç½®é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ Nginx é…ç½®ä¸­æœ‰ `try_files $uri $uri/ /index.html;`
2. å¯¹äºå­è·¯å¾„ï¼ˆ/adminã€/verifyï¼‰ï¼Œç¡®è®¤é…ç½®äº†æ­£ç¡®çš„ fallback
3. é‡å¯ Nginx

### é—®é¢˜5ï¼šè·¨åŸŸé—®é¢˜

**åŸå› **ï¼šAPI è¯·æ±‚è·¨åŸŸ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ Nginx åå‘ä»£ç†åï¼Œä¸åº”è¯¥æœ‰è·¨åŸŸé—®é¢˜
- å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥ `baseURL` é…ç½®æ˜¯å¦ä½¿ç”¨äº†ç›¸å¯¹è·¯å¾„

---

## ğŸ“Š éƒ¨ç½²æ¶æ„å›¾

```
ç”¨æˆ·æµè§ˆå™¨
    â†“
åŸŸå (www.example.com)
    â†“
Nginx (80/443)
    â†“
    â”œâ”€â†’ /           â†’ /www/wwwroot/buyticket/frontend-a (ç”¨æˆ·ç«¯)
    â”œâ”€â†’ /admin/     â†’ /www/wwwroot/buyticket/frontend-b (ç®¡ç†ç«¯)
    â”œâ”€â†’ /verify/    â†’ /www/wwwroot/buyticket/frontend-c (æ ¸é”€ç«¯)
    â””â”€â†’ /api/*      â†’ http://127.0.0.1:8080 (åç«¯æœåŠ¡)
                            â†“
                      Spring Boot åº”ç”¨
                            â†“
                      MySQL æ•°æ®åº“
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ä¸‰ä¸ªå‰ç«¯é¡¹ç›®æ„å»ºæˆåŠŸ
- [ ] æ–‡ä»¶ä¸Šä¼ åˆ°æ­£ç¡®çš„ç›®å½•
- [ ] Nginx é…ç½®æ­£ç¡®
- [ ] åç«¯é…ç½®æ–‡ä»¶ä¿®æ”¹æ­£ç¡®
- [ ] åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ
- [ ] SSL è¯ä¹¦é…ç½®æˆåŠŸï¼ˆå¯é€‰ï¼‰
- [ ] ç”¨æˆ·ç«¯å¯ä»¥è®¿é—®
- [ ] ç®¡ç†ç«¯å¯ä»¥è®¿é—®
- [ ] æ ¸é”€ç«¯å¯ä»¥è®¿é—®
- [ ] API è¯·æ±‚æ­£å¸¸
- [ ] æ”¯ä»˜åŠŸèƒ½æµ‹è¯•é€šè¿‡

---

## ğŸ¯ ä¼˜åŠ¿

ä½¿ç”¨å•åŸŸåéƒ¨ç½²çš„ä¼˜åŠ¿ï¼š

1. âœ… **æˆæœ¬ä½**ï¼šåªéœ€è¦ä¸€ä¸ªåŸŸå
2. âœ… **é…ç½®ç®€å•**ï¼šåªéœ€è¦é…ç½®ä¸€ä¸ªç½‘ç«™
3. âœ… **æ˜“äºç®¡ç†**ï¼šæ‰€æœ‰æœåŠ¡åœ¨ä¸€ä¸ªåŸŸåä¸‹
4. âœ… **æ— è·¨åŸŸé—®é¢˜**ï¼šé€šè¿‡ Nginx ä»£ç†è§£å†³
5. âœ… **SEO å‹å¥½**ï¼šç»Ÿä¸€åŸŸåæƒé‡
6. âœ… **SSL è¯ä¹¦ç®€å•**ï¼šåªéœ€è¦ä¸€ä¸ªè¯ä¹¦

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **è·¯ç”±æ¨¡å¼**ï¼šæ‰€æœ‰å‰ç«¯éƒ½ä½¿ç”¨ `history` æ¨¡å¼ï¼ˆVue Routerï¼‰
2. **base è·¯å¾„**ï¼šå¿…é¡»ä¸ Nginx é…ç½®çš„ location ä¸€è‡´
3. **API è·¯å¾„**ï¼šç»Ÿä¸€ä½¿ç”¨ `/api/v1` å‰ç¼€
4. **é™æ€èµ„æº**ï¼šä¼šè‡ªåŠ¨åŠ ä¸Šå¯¹åº”çš„ base è·¯å¾„
5. **åç«¯ç«¯å£**ï¼šç¡®è®¤åç«¯è¿è¡Œåœ¨ 8080 ç«¯å£
6. **åŸŸåæ›¿æ¢**ï¼šæ‰€æœ‰ `www.example.com` éƒ½è¦æ›¿æ¢ä¸ºä½ çš„çœŸå®åŸŸå

---

## ğŸ‰ å®Œæˆ

å¦‚æœæ‰€æœ‰æ­¥éª¤éƒ½å®Œæˆï¼Œä½ åº”è¯¥å¯ä»¥ï¼š

- âœ… è®¿é—® `https://www.example.com/` ä½¿ç”¨ç”¨æˆ·ç«¯
- âœ… è®¿é—® `https://www.example.com/admin/` ä½¿ç”¨ç®¡ç†ç«¯
- âœ… è®¿é—® `https://www.example.com/verify/` ä½¿ç”¨æ ¸é”€ç«¯
- âœ… æ‰€æœ‰ API è¯·æ±‚æ­£å¸¸å·¥ä½œ
- âœ… æ”¯ä»˜åŠŸèƒ½æ­£å¸¸

ç¥ä½ éƒ¨ç½²æˆåŠŸï¼ğŸŠ

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—ï¼š`/www/wwwlogs/buyticket_error.log`
2. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`/www/wwwroot/logs/buyticket/application.log`
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
4. å‚è€ƒã€Šå®å¡”é¢æ¿éƒ¨ç½²å®Œæ•´æŒ‡å—.mdã€‹
5. å‚è€ƒã€ŠSINGLE_DOMAIN_DEPLOYMENT.mdã€‹
